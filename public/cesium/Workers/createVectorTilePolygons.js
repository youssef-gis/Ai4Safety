import{a as e}from"./chunk-GTQ3WXPT.js";import{a as t}from"./chunk-D2NFCOGE.js";import{a as n}from"./chunk-SCO7TMKT.js";import{a as r}from"./chunk-VHZAK4GN.js";import"./chunk-ET7KY3BS.js";import"./chunk-CUP6SILZ.js";import"./chunk-HSJ6GSLC.js";import"./chunk-SXKYZMEL.js";import{a as a}from"./chunk-T6Q6HX5J.js";import"./chunk-XQIJGAVD.js";import{i as o}from"./chunk-UTYWXSQT.js";import"./chunk-RCHWDG3R.js";import"./chunk-4WJUWBRK.js";import"./chunk-5G23AKP3.js";import{a as i,b as s,d as f}from"./chunk-KWAHJ72S.js";import{a as l}from"./chunk-MKDADUG3.js";import"./chunk-NOIUI5SY.js";import{e as c}from"./chunk-XRRBRTKL.js";var h=new i,u=new f,p=new o,d={min:void 0,max:void 0,indexBytesPerElement:void 0},m=new i,g=new i,k=new i,y=new i,w=new i,b=new s,A=new o,x=t(function(t,x){let L,j,T;j=new Float64Array(t.packedBuffer),T=0,d.indexBytesPerElement=j[T++],d.min=j[T++],d.max=j[T++],i.unpack(j,T,h),T+=i.packedLength,f.unpack(j,T,u),T+=f.packedLength,o.unpack(j,T,p),L=2===d.indexBytesPerElement?new Uint16Array(t.indices):new Uint32Array(t.indices);let I=new Uint16Array(t.positions),S=new Uint32Array(t.counts),U=new Uint32Array(t.indexCounts),E=new Uint32Array(t.batchIds),O=new Uint32Array(t.batchTableColors),B=Array(S.length),G=p,R=d.min,C=d.max,N=t.minimumHeights,D=t.maximumHeights;c(N)&&c(D)&&(N=new Float32Array(N),D=new Float32Array(D));let K,P,H,M=I.length/2,F=I.subarray(0,M),J=I.subarray(M,2*M);r.zigZagDeltaDecode(F,J);let W=new Float64Array(3*M);for(K=0;K<M;++K){let e=F[K],t=J[K],n=l.lerp(G.west,G.east,e/32767),r=l.lerp(G.south,G.north,t/32767),a=s.fromRadians(n,r,0,b),o=u.cartographicToCartesian(a,m);i.pack(o,W,3*K)}let X=S.length,Y=Array(X),v=Array(X),Q=0,Z=0;for(K=0;K<X;++K)Y[K]=Q,v[K]=Z,Q+=S[K],Z+=U[K];let _=new Float32Array(3*M*2),V=new Uint16Array(2*M),z=new Uint32Array(v.length),q=new Uint32Array(U.length),$=[],ee={};for(K=0;K<X;++K)c(ee[H=O[K]])?(ee[H].positionLength+=S[K],ee[H].indexLength+=U[K],ee[H].batchIds.push(K)):ee[H]={positionLength:S[K],indexLength:U[K],offset:0,indexOffset:0,batchIds:[K]};let et,en=0,er=0;for(H in ee)if(ee.hasOwnProperty(H)){(et=ee[H]).offset=en,et.indexOffset=er;let e=2*et.positionLength,t=2*et.indexLength+6*et.positionLength;en+=e,er+=t,et.indexLength=t}let ea=[];for(H in ee)ee.hasOwnProperty(H)&&(et=ee[H],ea.push({color:e.fromRgba(parseInt(H)),offset:et.indexOffset,count:et.indexLength,batchIds:et.batchIds}));for(K=0;K<X;++K){let e=(et=ee[H=O[K]]).offset,t=3*e,r=e,a=Y[K],o=S[K],s=E[K],f=R,l=C;c(N)&&c(D)&&(f=N[K],l=D[K]);let p=1/0,d=-1/0,x=1/0,j=-1/0;for(P=0;P<o;++P){let e=i.unpack(W,3*a+3*P,m);u.scaleToGeodeticSurface(e,e);let n=u.cartesianToCartographic(e,b),o=n.latitude,c=n.longitude;p=Math.min(o,p),d=Math.max(o,d),x=Math.min(c,x),j=Math.max(c,j);let A=u.geodeticSurfaceNormal(e,g),L=i.multiplyByScalar(A,f,k),T=i.add(e,L,y);L=i.multiplyByScalar(A,l,L);let I=i.add(e,L,w);i.subtract(I,h,I),i.subtract(T,h,T),i.pack(I,_,t),i.pack(T,_,t+3),V[r]=s,V[r+1]=s,t+=6,r+=2}(G=A).west=x,G.east=j,G.south=p,G.north=d,B[K]=n.fromRectangle(G,R,C,u);let T=et.indexOffset,I=v[K],M=U[K];for(z[K]=T,P=0;P<M;P+=3){let t=L[I+P]-a,n=L[I+P+1]-a,r=L[I+P+2]-a;$[T++]=2*t+e,$[T++]=2*n+e,$[T++]=2*r+e,$[T++]=2*r+1+e,$[T++]=2*n+1+e,$[T++]=2*t+1+e}for(P=0;P<o;++P){let t=P,n=(P+1)%o;$[T++]=2*t+1+e,$[T++]=2*n+e,$[T++]=2*t+e,$[T++]=2*t+1+e,$[T++]=2*n+1+e,$[T++]=2*n+e}et.offset+=2*o,et.indexOffset=T,q[K]=T-z[K]}$=a.createTypedArray(_.length/3,$);let eo=ea.length;for(let e=0;e<eo;++e){let t=ea[e].batchIds,n=0,r=t.length;for(let e=0;e<r;++e)n+=q[t[e]];ea[e].count=n}let ei=function(t,r,a){let o=r.length,i=new Float64Array(2+o*n.packedLength+1+function(t){let n=t.length,r=0;for(let a=0;a<n;++a)r+=e.packedLength+3+t[a].batchIds.length;return r}(a)),s=0;i[s++]=t,i[s++]=o;for(let e=0;e<o;++e)n.pack(r[e],i,s),s+=n.packedLength;let f=a.length;i[s++]=f;for(let t=0;t<f;++t){let n=a[t];e.pack(n.color,i,s),s+=e.packedLength,i[s++]=n.offset,i[s++]=n.count;let r=n.batchIds,o=r.length;i[s++]=o;for(let e=0;e<o;++e)i[s++]=r[e]}return i}(2===$.BYTES_PER_ELEMENT?a.UNSIGNED_SHORT:a.UNSIGNED_INT,B,ea);return x.push(_.buffer,$.buffer,z.buffer,q.buffer,V.buffer,ei.buffer),{positions:_.buffer,indices:$.buffer,indexOffsets:z.buffer,indexCounts:q.buffer,batchIds:V.buffer,packedBuffer:ei.buffer}});export{x as default};