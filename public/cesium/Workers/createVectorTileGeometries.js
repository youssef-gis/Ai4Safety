import{a as e}from"./chunk-GTQ3WXPT.js";import{a as t}from"./chunk-BTDQB5Q4.js";import"./chunk-XQDTMI7Q.js";import{a as n}from"./chunk-CJRI54BI.js";import{a as r}from"./chunk-D2NFCOGE.js";import{a as o}from"./chunk-KX5PR5Q3.js";import"./chunk-T77EB7BE.js";import"./chunk-APG2S62J.js";import{a as i}from"./chunk-T6Q6HX5J.js";import"./chunk-4MJDNHOT.js";import"./chunk-EDF5FKWJ.js";import{d as s}from"./chunk-XQIJGAVD.js";import{b as a}from"./chunk-UTYWXSQT.js";import"./chunk-RCHWDG3R.js";import"./chunk-4WJUWBRK.js";import"./chunk-5G23AKP3.js";import{a as c}from"./chunk-KWAHJ72S.js";import"./chunk-MKDADUG3.js";import"./chunk-NOIUI5SY.js";import{e as l}from"./chunk-XRRBRTKL.js";var u=function(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds},d=new c,f=a.packedLength+c.packedLength,h=a.packedLength+2,p=a.packedLength+c.packedLength,m=c.packedLength+1,b={modelMatrix:new a,boundingVolume:new s};function k(e,t){let n=t*f,r=c.unpack(e,n,d);n+=c.packedLength;let o=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(o,r,o);let i=b.boundingVolume;return c.clone(c.ZERO,i.center),i.radius=Math.sqrt(3),b}function g(e,t){let n=t*h,r=e[n++],o=e[n++],i=c.fromElements(r,r,o,d),s=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(s,i,s);let l=b.boundingVolume;return c.clone(c.ZERO,l.center),l.radius=Math.sqrt(2),b}function y(e,t){let n=t*p,r=c.unpack(e,n,d);n+=c.packedLength;let o=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(o,r,o);let i=b.boundingVolume;return c.clone(c.ZERO,i.center),i.radius=1,b}function I(e,t){let n=t*m,r=e[n++],o=c.unpack(e,n,d),i=a.fromTranslation(o,b.modelMatrix);a.multiplyByUniformScale(i,r,i);let s=b.boundingVolume;return c.clone(c.ZERO,s.center),s.radius=1,b}var x=new c;function B(t,n,r,o,i){if(!l(n))return;let d=r.length,f=o.attributes.position.values,h=o.indices,p=t.positions,m=t.vertexBatchIds,b=t.indices,k=t.batchIds,g=t.batchTableColors,y=t.batchedIndices,I=t.indexOffsets,B=t.indexCounts,A=t.boundingVolumes,w=t.modelMatrix,j=t.center,O=t.positionOffset,v=t.batchIdIndex,T=t.indexOffset,U=t.batchedIndicesOffset;for(let t=0;t<d;++t){let o=i(n,t),l=o.modelMatrix;a.multiply(w,l,l);let d=r[t],E=f.length;for(let e=0;e<E;e+=3){let t=c.unpack(f,e,x);a.multiplyByPoint(l,t,t),c.subtract(t,j,t),c.pack(t,p,3*O+e),m[v++]=d}let L=h.length;for(let e=0;e<L;++e)b[T+e]=h[e]+O;let M=t+U;y[M]=new u({offset:T,count:L,color:e.fromRgba(g[d]),batchIds:[d]}),k[M]=d,I[M]=T,B[M]=L,A[M]=s.transform(o.boundingVolume,l),O+=E/3,T+=L}t.positionOffset=O,t.batchIdIndex=v,t.indexOffset=T,t.batchedIndicesOffset+=d}var A=new c,w=new a,j=r(function(r,u){let d,f,h=l(r.boxes)?new Float32Array(r.boxes):void 0,p=l(r.boxBatchIds)?new Uint16Array(r.boxBatchIds):void 0,m=l(r.cylinders)?new Float32Array(r.cylinders):void 0,b=l(r.cylinderBatchIds)?new Uint16Array(r.cylinderBatchIds):void 0,x=l(r.ellipsoids)?new Float32Array(r.ellipsoids):void 0,j=l(r.ellipsoidBatchIds)?new Uint16Array(r.ellipsoidBatchIds):void 0,O=l(r.spheres)?new Float32Array(r.spheres):void 0,v=l(r.sphereBatchIds)?new Uint16Array(r.sphereBatchIds):void 0,T=l(h)?p.length:0,U=l(m)?b.length:0,E=l(x)?j.length:0,L=l(O)?v.length:0,M=o.getUnitBox(),R=t.getUnitCylinder(),C=n.getUnitEllipsoid(),F=M.attributes.position.values,D=R.attributes.position.values,Q=C.attributes.position.values,S=F.length*T;S+=D.length*U+Q.length*(E+L);let V=M.indices,J=R.indices,G=C.indices,K=V.length*T;K+=J.length*U+G.length*(E+L);let W=new Float32Array(S),X=new Uint16Array(S/3),P=i.createTypedArray(S/3,K),H=T+U+E+L,N=new Uint16Array(H),Z=Array(H),Y=new Uint32Array(H),q=new Uint32Array(H),_=Array(H);d=new Float64Array(r.packedBuffer),f=0,c.unpack(d,f,A),f+=c.packedLength,a.unpack(d,f,w);let z={batchTableColors:new Uint32Array(r.batchTableColors),positions:W,vertexBatchIds:X,indices:P,batchIds:N,batchedIndices:Z,indexOffsets:Y,indexCounts:q,boundingVolumes:_,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:w,center:A};B(z,h,p,M,k),B(z,m,b,R,g),B(z,x,j,C,y),B(z,O,v,C,I);let $=function(t,n,r){let o=r.length,i=new Float64Array(2+o*s.packedLength+1+function(t){let n=t.length,r=0;for(let o=0;o<n;++o)r+=e.packedLength+3+t[o].batchIds.length;return r}(n)),a=0;i[a++]=t,i[a++]=o;for(let e=0;e<o;++e)s.pack(r[e],i,a),a+=s.packedLength;let c=n.length;i[a++]=c;for(let t=0;t<c;++t){let r=n[t];e.pack(r.color,i,a),a+=e.packedLength,i[a++]=r.offset,i[a++]=r.count;let o=r.batchIds,s=o.length;i[a++]=s;for(let e=0;e<s;++e)i[a++]=o[e]}return i}(P.BYTES_PER_ELEMENT,Z,_);return u.push(W.buffer,X.buffer,P.buffer),u.push(N.buffer,Y.buffer,q.buffer),u.push($.buffer),{positions:W.buffer,vertexBatchIds:X.buffer,indices:P.buffer,indexOffsets:Y.buffer,indexCounts:q.buffer,batchIds:N.buffer,packedBuffer:$.buffer}});export{j as default};