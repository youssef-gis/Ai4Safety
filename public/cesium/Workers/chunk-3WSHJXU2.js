import{a as e}from"./chunk-OXJ2LJUE.js";import{a as t}from"./chunk-3BSRJTW3.js";import{a as n,b as i}from"./chunk-IYO6TYGP.js";import{a as o}from"./chunk-AZLP5742.js";import{a as r}from"./chunk-5HPISDSZ.js";import{b as s}from"./chunk-HSJ6GSLC.js";import{a as a}from"./chunk-SXKYZMEL.js";import{a as l}from"./chunk-T6Q6HX5J.js";import{a as u}from"./chunk-4MJDNHOT.js";import{b as c,c as h,d as f}from"./chunk-EDF5FKWJ.js";import{g as p}from"./chunk-UTYWXSQT.js";import{a as g}from"./chunk-RCHWDG3R.js";import{a as d,b as m,c as y,d as v,e as b}from"./chunk-KWAHJ72S.js";import{a as x}from"./chunk-MKDADUG3.js";import{e as w}from"./chunk-XRRBRTKL.js";var L=function(e,t){this.positions=w(e)?e:[],this.holes=w(t)?t:[]};function T(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(T.prototype,{length:{get:function(){return this._length}}}),T.prototype.enqueue=function(e){this._array.push(e),this._length++},T.prototype.dequeue=function(){if(0===this._length)return;let e=this._array,t=this._offset,n=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,n},T.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},T.prototype.contains=function(e){return -1!==this._array.indexOf(e)},T.prototype.clear=function(){this._array.length=this._offset=this._length=0},T.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var S={};S.computeHierarchyPackedLength=function(e,t){let n=0,i=[e];for(;i.length>0;){let e=i.pop();if(!w(e))continue;n+=2;let o=e.positions,r=e.holes;if(w(o)&&o.length>0&&(n+=o.length*t.packedLength),w(r)){let e=r.length;for(let t=0;t<e;++t)i.push(r[t])}}return n},S.packPolygonHierarchy=function(e,t,n,i){let o=[e];for(;o.length>0;){let e=o.pop();if(!w(e))continue;let r=e.positions,s=e.holes;if(t[n++]=w(r)?r.length:0,t[n++]=w(s)?s.length:0,w(r)){let e=r.length;for(let o=0;o<e;++o,n+=i.packedLength)i.pack(r[o],t,n)}if(w(s)){let e=s.length;for(let t=0;t<e;++t)o.push(s[t])}}return n},S.unpackPolygonHierarchy=function(e,t,n){let i=e[t++],o=e[t++],r=Array(i),s=o>0?Array(o):void 0;for(let o=0;o<i;++o,t+=n.packedLength)r[o]=n.unpack(e,t);for(let i=0;i<o;++i)s[i]=S.unpackPolygonHierarchy(e,t,n),t=s[i].startingIndex,delete s[i].startingIndex;return{positions:r,holes:s,startingIndex:t}};var M=new y;function E(e,t,n,i){return y.subtract(t,e,M),y.multiplyByScalar(M,n/i,M),y.add(e,M,M),[M.x,M.y]}var _=new d;S.subdivideLineCount=function(e,t,n){let i=d.distance(e,t)/n;return Math.pow(2,Math.max(0,Math.ceil(x.log2(i))))};var k=new m,A=new m,C=new m,D=new d,R=new r;S.subdivideRhumbLineCount=function(e,t,n,i){let o=new r(e.cartesianToCartographic(t,k),e.cartesianToCartographic(n,A),e).surfaceDistance/i;return Math.pow(2,Math.max(0,Math.ceil(x.log2(o))))},S.subdivideTexcoordLine=function(e,t,n,i,o,r){let s=S.subdivideLineCount(n,i,o),a=y.distance(e,t),l=a/s;r.length=2*s;let u=0;for(let n=0;n<s;n++){let i=E(e,t,n*l,a);r[u++]=i[0],r[u++]=i[1]}return r},S.subdivideLine=function(e,t,n,i){let o=S.subdivideLineCount(e,t,n),r=d.distance(e,t),s=r/o;w(i)||(i=[]);let a=i;a.length=3*o;let l=0;for(let n=0;n<o;n++){var u;let i=(u=n*s,d.subtract(t,e,_),d.multiplyByScalar(_,u/r,_),d.add(e,_,_),[_.x,_.y,_.z]);a[l++]=i[0],a[l++]=i[1],a[l++]=i[2]}return a},S.subdivideTexcoordRhumbLine=function(e,t,n,i,o,r,s){let a=n.cartesianToCartographic(i,k),l=n.cartesianToCartographic(o,A);R.setEndPoints(a,l);let u=R.surfaceDistance/r,c=Math.pow(2,Math.max(0,Math.ceil(x.log2(u)))),h=y.distance(e,t),f=h/c;s.length=2*c;let p=0;for(let n=0;n<c;n++){let i=E(e,t,n*f,h);s[p++]=i[0],s[p++]=i[1]}return s},S.subdivideRhumbLine=function(e,t,n,i,o){let s=new r(e.cartesianToCartographic(t,k),e.cartesianToCartographic(n,A),e);if(w(o)||(o=[]),s.surfaceDistance<=i)return o.length=3,o[0]=t.x,o[1]=t.y,o[2]=t.z,o;let a=s.surfaceDistance/i,l=Math.pow(2,Math.max(0,Math.ceil(x.log2(a)))),u=s.surfaceDistance/l,c=o;c.length=3*l;let h=0;for(let t=0;t<l;t++){let n=s.interpolateUsingSurfaceDistance(t*u,C),i=e.cartographicToCartesian(n,D);c[h++]=i.x,c[h++]=i.y,c[h++]=i.z}return c};var O=new d,P=new d,G=new d,I=new d;S.scaleToGeodeticHeightExtruded=function(e,t,n,i,o){i=i??v.default;let r=P,s=I;if(w(e)&&w(e.attributes)&&w(e.attributes.position)){let a=e.attributes.position.values,l=a.length/2;for(let e=0;e<l;e+=3)d.fromArray(a,e,G),i.geodeticSurfaceNormal(G,O),s=i.scaleToGeodeticSurface(G,s),r=d.multiplyByScalar(O,n,r),r=d.add(s,r,r),a[e+l]=r.x,a[e+1+l]=r.y,a[e+2+l]=r.z,o&&(s=d.clone(G,s)),r=d.multiplyByScalar(O,t,r),r=d.add(s,r,r),a[e]=r.x,a[e+1]=r.y,a[e+2]=r.z}return e},S.polygonOutlinesFromHierarchy=function(e,t,n){let i,r,s,a=[],l=new T;for(l.enqueue(e);0!==l.length;){let e=l.dequeue(),u=e.positions;if(t)for(s=u.length,i=0;i<s;i++)n.scaleToGeodeticSurface(u[i],u[i]);if((u=o(u,d.equalsEpsilon,!0)).length<3)continue;let c=e.holes?e.holes.length:0;for(i=0;i<c;i++){let u=e.holes[i],c=u.positions;if(t)for(s=c.length,r=0;r<s;++r)n.scaleToGeodeticSurface(c[r],c[r]);if((c=o(c,d.equalsEpsilon,!0)).length<3)continue;a.push(c);let h=0;for(w(u.holes)&&(h=u.holes.length),r=0;r<h;r++)l.enqueue(u.holes[r])}a.push(u)}return a};var H=new m,j=new m;S.splitPolygonsOnEquator=function(t,n,i,o){w(o)||(o=[]),o.splice(0,0,...t),o.length=t.length;let r=0;for(;r<o.length;){let t=o[r],l=t.slice();if(t.length<3){o[r]=l,++r;continue}let u=function(t,n,i){let o=[],r,l,u,c,h,f=0;for(;f<t.length;){r=t[f],l=t[(f+1)%t.length],u=x.sign(r.z),c=x.sign(l.z);let p=e=>n.cartesianToCartographic(e,j).longitude;if(0===u)o.push({position:f,type:u,visited:!1,next:c,theta:p(r)});else if(0!==c){if(h=function(t,n,i,o){if(o===e.RHUMB)return function(e,t,n){let i=n.cartesianToCartographic(e,k),o=n.cartesianToCartographic(t,A);if(Math.sign(i.latitude)===Math.sign(o.latitude))return;R.setEndPoints(i,o);let r=R.findIntersectionWithLatitude(0,H);if(!w(r))return;let s=Math.min(i.longitude,o.longitude),a=Math.max(i.longitude,o.longitude);if(Math.abs(a-s)>x.PI){let e=s;s=a,a=e}if(!(r.longitude<s||r.longitude>a))return n.cartographicToCartesian(r)}(t,n,i);let r=s.lineSegmentPlane(t,n,a.ORIGIN_XY_PLANE);if(w(r))return i.scaleToGeodeticSurface(r,r)}(r,l,n,i),++f,!w(h))continue;t.splice(f,0,h),o.push({position:f,type:u,visited:!1,next:c,theta:p(h)})}++f}return o}(l,n,i);if(l.length===t.length||u.length<=1){o[r]=l,++r;continue}u.sort((e,t)=>e.theta-t.theta);let c=l[0].z>=0;r=function e(t,n,i,o,r,s,a){let l=[],u=s,c=e=>t=>t.position===e,h=[];do{let e=i[u];l.push(e);let t=o.findIndex(c(u)),n=o[t];if(!w(n)){++u;continue}let{visited:r,type:f,next:p}=n;if(n.visited=!0,0===f){if(0===p){let e=o[t-(a?1:-1)];if(e?.position===u+1)e.visited=!0;else{++u;continue}}if(!r&&a&&p>0||s===u&&!a&&p<0){++u;continue}}if(!(a?f>=0:f<=0)){++u;continue}r||h.push(u);let g=o[t+(a?1:-1)];if(!w(g)){++u;continue}u=g.position}while(u<i.length&&u>=0&&u!==s&&l.length<i.length);for(let s of(t.splice(n,r,l),h))n=e(t,++n,i,o,0,s,!a);return n}(o,r,l,u,1,0,c)}return o},S.polygonsFromHierarchy=function(e,t,r,s,a,l){let u=[],c=[],h=new T;h.enqueue(e);let f=w(l);for(;0!==h.length;){let e=h.dequeue(),p=e.positions,g=e.holes,m,y;if(s)for(y=p.length,m=0;m<y;m++)a.scaleToGeodeticSurface(p[m],p[m]);if(t||(p=o(p,d.equalsEpsilon,!0)),p.length<3)continue;let v=r(p);if(!w(v))continue;let b=[],x=i.computeWindingOrder2D(v);if(x===n.CLOCKWISE&&(v.reverse(),p=p.slice().reverse()),f){f=!1;let e=[p];if((e=l(e,e)).length>1){for(let t of e)h.enqueue(new L(t,g));continue}}let T=p.slice(),S=w(g)?g.length:0,M=[],E;for(m=0;m<S;m++){let e=g[m],l=e.positions;if(s)for(y=l.length,E=0;E<y;++E)a.scaleToGeodeticSurface(l[E],l[E]);if(t||(l=o(l,d.equalsEpsilon,!0)),l.length<3)continue;let u=r(l);if(!w(u))continue;(x=i.computeWindingOrder2D(u))===n.CLOCKWISE&&(u.reverse(),l=l.slice().reverse()),M.push(l),b.push(T.length),T=T.concat(l),v=v.concat(u);let c=0;for(w(e.holes)&&(c=e.holes.length),E=0;E<c;E++)h.enqueue(e.holes[E])}u.push({outerRing:p,holes:M}),c.push({positions:T,positions2D:v,holes:b})}return{hierarchy:u,polygons:c}};var q=new y,B=new d,z=new p,W=new b;S.computeBoundingRectangle=function(e,t,n,i,o){let r=p.fromAxisAngle(e,i,z),s=b.fromQuaternion(r,W),a=1/0,l=-1/0,u=1/0,c=-1/0,h=n.length;for(let e=0;e<h;++e){let i=d.clone(n[e],B);b.multiplyByVector(s,i,i);let o=t(i,q);w(o)&&(a=Math.min(a,o.x),l=Math.max(l,o.x),u=Math.min(u,o.y),c=Math.max(c,o.y))}return o.x=a,o.y=u,o.width=l-a,o.height=c-u,o},S.createGeometryFromPositions=function(n,o,r,s,a,l,u){let p=i.triangulate(o.positions2D,o.holes);p.length<3&&(p=[0,1,2]);let d=o.positions,m=w(r),v=m?r.positions:void 0;if(a){let e=d.length,n=Array(3*e),i=0;for(let t=0;t<e;t++){let e=d[t];n[i++]=e.x,n[i++]=e.y,n[i++]=e.z}let o={attributes:{position:new f({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:n})},indices:p,primitiveType:c.TRIANGLES};m&&(o.attributes.st=new f({componentDatatype:g.FLOAT,componentsPerAttribute:2,values:y.packArray(v)}));let r=new h(o);return l.normal?t.computeNormal(r):r}return u===e.GEODESIC?i.computeSubdivision(n,d,p,v,s):u===e.RHUMB?i.computeRhumbLineSubdivision(n,d,p,v,s):void 0};var U=[],N=[],J=new d,F=new d;S.computeWallGeometry=function(t,n,i,o,r,s){let a,p,m,y,v,b,L,T,M,E=t.length,_=0,k=0,A=w(n),C=A?n.positions:void 0;if(r)for(a=Array(2*(p=3*E*2)),A&&(T=Array(2*(M=2*E*2))),m=0;m<E;m++)y=t[m],v=t[(m+1)%E],a[_]=a[_+p]=y.x,a[++_]=a[_+p]=y.y,a[++_]=a[_+p]=y.z,a[++_]=a[_+p]=v.x,a[++_]=a[_+p]=v.y,a[++_]=a[_+p]=v.z,++_,A&&(b=C[m],L=C[(m+1)%E],T[k]=T[k+M]=b.x,T[++k]=T[k+M]=b.y,T[++k]=T[k+M]=L.x,T[++k]=T[k+M]=L.y,++k);else{let n=x.chordLength(o,i.maximumRadius),r=0;if(s===e.GEODESIC)for(m=0;m<E;m++)r+=S.subdivideLineCount(t[m],t[(m+1)%E],n);else if(s===e.RHUMB)for(m=0;m<E;m++)r+=S.subdivideRhumbLineCount(i,t[m],t[(m+1)%E],n);for(a=Array(2*(p=(r+E)*3)),A&&(T=Array(2*(M=(r+E)*2))),m=0;m<E;m++){let o,r;y=t[m],v=t[(m+1)%E],A&&(b=C[m],L=C[(m+1)%E]),s===e.GEODESIC?(o=S.subdivideLine(y,v,n,N),A&&(r=S.subdivideTexcoordLine(b,L,y,v,n,U))):s===e.RHUMB&&(o=S.subdivideRhumbLine(i,y,v,n,N),A&&(r=S.subdivideTexcoordRhumbLine(b,L,i,y,v,n,U)));let l=o.length;for(let e=0;e<l;++e,++_)a[_]=o[e],a[_+p]=o[e];if(a[_]=v.x,a[_+p]=v.x,a[++_]=v.y,a[_+p]=v.y,a[++_]=v.z,a[_+p]=v.z,++_,A){let e=r.length;for(let t=0;t<e;++t,++k)T[k]=r[t],T[k+M]=r[t];T[k]=L.x,T[k+M]=L.x,T[++k]=L.y,T[k+M]=L.y,++k}}}E=a.length;let D=l.createTypedArray(E/3,E-6*t.length),R=0;for(E/=6,m=0;m<E;m++){let e=m,t=e+1,n=e+E,i=n+1;y=d.fromArray(a,3*e,J),v=d.fromArray(a,3*t,F),d.equalsEpsilon(y,v,x.EPSILON10,x.EPSILON10)||(D[R++]=e,D[R++]=n,D[R++]=t,D[R++]=t,D[R++]=n,D[R++]=i)}let O={attributes:new u({position:new f({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:a})}),indices:D,primitiveType:c.TRIANGLES};return A&&(O.attributes.st=new f({componentDatatype:g.FLOAT,componentsPerAttribute:2,values:T})),new h(O)};var K=S;export{K as a};