import{a as e,b as t}from"./chunk-BJAB7QAF.js";import{a as i}from"./chunk-D2NFCOGE.js";import{a as n}from"./chunk-SCO7TMKT.js";import{a as s}from"./chunk-VHZAK4GN.js";import"./chunk-ET7KY3BS.js";import"./chunk-CUP6SILZ.js";import"./chunk-HSJ6GSLC.js";import"./chunk-SXKYZMEL.js";import{a as r}from"./chunk-T6Q6HX5J.js";import{d as h}from"./chunk-XQIJGAVD.js";import{i as u}from"./chunk-UTYWXSQT.js";import"./chunk-RCHWDG3R.js";import"./chunk-4WJUWBRK.js";import"./chunk-5G23AKP3.js";import{a as o,b as p,c as l,d as f}from"./chunk-KWAHJ72S.js";import{a as d}from"./chunk-MKDADUG3.js";import{a as a,b as c}from"./chunk-NOIUI5SY.js";import{e as g}from"./chunk-XRRBRTKL.js";var m={};m.clipTriangleAtAxisAlignedThreshold=function(e,t,i,n,s,r){let h,u,o;if(!g(e))throw new a("threshold is required.");if(!g(t))throw new a("keepAbove is required.");if(!g(i))throw new a("u0 is required.");if(!g(n))throw new a("u1 is required.");if(!g(s))throw new a("u2 is required.");g(r)?r.length=0:r=[],t?(h=i<e,u=n<e,o=s<e):(h=i>e,u=n>e,o=s>e);let p=h+u+o,l,f,d,c,m,w;return 1===p?h?(l=(e-i)/(n-i),f=(e-i)/(s-i),r.push(1),r.push(2),1!==f&&(r.push(-1),r.push(0),r.push(2),r.push(f)),1!==l&&(r.push(-1),r.push(0),r.push(1),r.push(l))):u?(d=(e-n)/(s-n),c=(e-n)/(i-n),r.push(2),r.push(0),1!==c&&(r.push(-1),r.push(1),r.push(0),r.push(c)),1!==d&&(r.push(-1),r.push(1),r.push(2),r.push(d))):o&&(m=(e-s)/(i-s),w=(e-s)/(n-s),r.push(0),r.push(1),1!==w&&(r.push(-1),r.push(2),r.push(1),r.push(w)),1!==m&&(r.push(-1),r.push(2),r.push(0),r.push(m))):2===p?h||i===e?u||n===e?o||s===e||(f=(e-i)/(s-i),d=(e-n)/(s-n),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(f),r.push(-1),r.push(1),r.push(2),r.push(d)):(w=(e-s)/(n-s),l=(e-i)/(n-i),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(w),r.push(-1),r.push(0),r.push(1),r.push(l)):(c=(e-n)/(i-n),m=(e-s)/(i-s),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(c),r.push(-1),r.push(2),r.push(0),r.push(m)):3!==p&&(r.push(0),r.push(1),r.push(2)),r},m.computeBarycentricCoordinates=function(e,t,i,n,s,r,h,u,p){if(!g(e))throw new a("x is required.");if(!g(t))throw new a("y is required.");if(!g(i))throw new a("x1 is required.");if(!g(n))throw new a("y1 is required.");if(!g(s))throw new a("x2 is required.");if(!g(r))throw new a("y2 is required.");if(!g(h))throw new a("x3 is required.");if(!g(u))throw new a("y3 is required.");let l=i-h,f=h-s,d=r-u,c=n-u,m=1/(d*l+f*c),w=t-u,x=e-h,y=(d*x+f*w)*m,B=(-c*x+l*w)*m,A=1-y-B;return g(p)?(p.x=y,p.y=B,p.z=A,p):new o(y,B,A)},m.computeLineSegmentLineSegmentIntersection=function(e,t,i,n,s,r,h,u,o){c.typeOf.number("x00",e),c.typeOf.number("y00",t),c.typeOf.number("x01",i),c.typeOf.number("y01",n),c.typeOf.number("x10",s),c.typeOf.number("y10",r),c.typeOf.number("x11",h),c.typeOf.number("y11",u);let p=(h-s)*(t-r)-(u-r)*(e-s),f=(i-e)*(t-r)-(n-t)*(e-s),d=(u-r)*(i-e)-(h-s)*(n-t);if(0===d)return;let a=p/d,m=f/d;if(a>=0&&a<=1&&m>=0&&m<=1)return g(o)||(o=new l),o.x=e+a*(i-e),o.y=t+a*(n-t),o};var w=[],x=[],y=[],B=new p,A=new o,I=[],v=[],b=[],k=[],C=[],T=new o,j=new h,N=new n,O=new l,V=new o;function z(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}z.prototype.clone=function(e){return g(e)||(e=new z),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},z.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},z.prototype.initializeFromClipResult=function(e,t,i){let n=t+1;return -1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},z.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},z.prototype.isIndexed=function(){return g(this.index)},z.prototype.getH=function(){return g(this.index)?this.heightBuffer[this.index]:d.lerp(this.first.getH(),this.second.getH(),this.ratio)},z.prototype.getU=function(){return g(this.index)?this.uBuffer[this.index]:d.lerp(this.first.getU(),this.second.getU(),this.ratio)},z.prototype.getV=function(){return g(this.index)?this.vBuffer[this.index]:d.lerp(this.first.getV(),this.second.getV(),this.ratio)};var H=new l,R=-1,S=[new o,new o],q=[new o,new o];function K(e,t){let i=S[++R],n=q[R];return i=s.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),n=s.octDecode(e.second.getNormalX(),e.second.getNormalY(),n),A=o.lerp(i,n,e.ratio,A),o.normalize(A,A),s.octEncode(A,t),--R,t}z.prototype.getNormalX=function(){return g(this.index)?this.normalBuffer[2*this.index]:(H=K(this,H)).x},z.prototype.getNormalY=function(){return g(this.index)?this.normalBuffer[2*this.index+1]:(H=K(this,H)).y};var U=[];function X(e,t,i,n,s,r,h,u,o){if(0===h.length)return;let p=0,l=0;for(;l<h.length;)l=U[p++].initializeFromClipResult(h,l,u);for(let s=0;s<p;++s){let h=U[s];if(h.isIndexed())h.newIndex=r[h.index],h.uBuffer=e,h.vBuffer=t,h.heightBuffer=i,o&&(h.normalBuffer=n);else{let s=h.getKey();if(g(r[s]))h.newIndex=r[s];else{let u=e.length;e.push(h.getU()),t.push(h.getV()),i.push(h.getH()),o&&(n.push(h.getNormalX()),n.push(h.getNormalY())),h.newIndex=u,r[s]=u}}}3===p?(s.push(U[0].newIndex),s.push(U[1].newIndex),s.push(U[2].newIndex)):4===p&&(s.push(U[0].newIndex),s.push(U[1].newIndex),s.push(U[2].newIndex),s.push(U[0].newIndex),s.push(U[2].newIndex),s.push(U[3].newIndex))}U.push(new z),U.push(new z),U.push(new z),U.push(new z);var E=i(function(i,s){let p,l=i.isEastChild,a=i.isNorthChild,c=16383*!!l,g=l?32767:16383,H=16383*!!a,R=a?32767:16383;I.length=0,v.length=0,b.length=0,C.length=0,k.length=0;let S={},q=i.vertices,K=i.indices;K=K.subarray(0,i.indexCountWithoutSkirts);let U=t.clone(i.encoding),E=U.hasVertexNormals,F=0,W=i.vertexCountWithoutSkirts,Y=i.minimumHeight,D=i.maximumHeight,G=Array(W),J=Array(W),L=Array(W),M=E?Array(2*W):void 0,P,Q,Z,_,$;for(Q=0,Z=0;Q<W;++Q,Z+=2){let e=U.decodeTextureCoordinates(q,Q,O);if(P=U.decodeHeight(q,Q),_=d.clamp(32767*e.x|0,0,32767),$=d.clamp(32767*e.y|0,0,32767),L[Q]=d.clamp((P-Y)/(D-Y)*32767|0,0,32767),_<20&&(_=0),$<20&&($=0),32767-_<20&&(_=32767),32767-$<20&&($=32767),G[Q]=_,J[Q]=$,E){let e=U.getOctEncodedNormal(q,Q,V);M[Z]=e.x,M[Z+1]=e.y}(l&&_>=16383||!l&&_<=16383)&&(a&&$>=16383||!a&&$<=16383)&&(S[Q]=F,I.push(_),v.push($),b.push(L[Q]),E&&(C.push(M[Z]),C.push(M[Z+1])),++F)}let ee=[];ee.push(new z),ee.push(new z),ee.push(new z);let et=[];for(et.push(new z),et.push(new z),et.push(new z),Q=0;Q<K.length;Q+=3){let e=K[Q],t=K[Q+1],i=K[Q+2],n=G[e],s=G[t],r=G[i];ee[0].initializeIndexed(G,J,L,M,e),ee[1].initializeIndexed(G,J,L,M,t),ee[2].initializeIndexed(G,J,L,M,i);let h=m.clipTriangleAtAxisAlignedThreshold(16383,l,n,s,r,w);!((p=0)>=h.length)&&((p=et[0].initializeFromClipResult(h,p,ee))>=h.length||!((p=et[1].initializeFromClipResult(h,p,ee))>=h.length)&&(p=et[2].initializeFromClipResult(h,p,ee),X(I,v,b,C,k,S,m.clipTriangleAtAxisAlignedThreshold(16383,a,et[0].getV(),et[1].getV(),et[2].getV(),x),et,E),p<h.length&&(et[2].clone(et[1]),et[2].initializeFromClipResult(h,p,ee),X(I,v,b,C,k,S,m.clipTriangleAtAxisAlignedThreshold(16383,a,et[0].getV(),et[1].getV(),et[2].getV(),x),et,E))))}let ei=l?-32767:0,en=a?-32767:0,es=[],er=[],eh=[],eu=[],eo=Number.MAX_VALUE,ep=-eo;y.length=0;let el=f.clone(i.ellipsoid),ef=u.clone(i.childRectangle),ed=ef.north,ea=ef.south,ec=ef.east,eg=ef.west;for(ec<eg&&(ec+=d.TWO_PI),Q=0;Q<I.length;++Q)(_=Math.round(I[Q]))<=c?(es.push(Q),_=0):_>=g?(eh.push(Q),_=32767):_=2*_+ei,I[Q]=_,($=Math.round(v[Q]))<=H?(er.push(Q),$=0):$>=R?(eu.push(Q),$=32767):$=2*$+en,v[Q]=$,(P=d.lerp(Y,D,b[Q]/32767))<eo&&(eo=P),P>ep&&(ep=P),b[Q]=P,B.longitude=d.lerp(eg,ec,_/32767),B.latitude=d.lerp(ea,ed,$/32767),B.height=P,el.cartographicToCartesian(B,A),y.push(A.x),y.push(A.y),y.push(A.z);let em=h.fromVertices(y,o.ZERO,3,j),ew=n.fromRectangle(ef,eo,ep,el,N),ex=new e(el).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(em.center,y,3,em.center,eo,T),ey=ep-eo,eB=new Uint16Array(I.length+v.length+b.length);for(Q=0;Q<I.length;++Q)eB[Q]=I[Q];let eA=I.length;for(Q=0;Q<v.length;++Q)eB[eA+Q]=v[Q];for(eA+=v.length,Q=0;Q<b.length;++Q)eB[eA+Q]=32767*(b[Q]-eo)/ey;let eI=r.createTypedArray(I.length,k),ev;if(E){let e=new Uint8Array(C);s.push(eB.buffer,eI.buffer,e.buffer),ev=e.buffer}else s.push(eB.buffer,eI.buffer);return{vertices:eB.buffer,encodedNormals:ev,indices:eI.buffer,minimumHeight:eo,maximumHeight:ep,westIndices:es,southIndices:er,eastIndices:eh,northIndices:eu,boundingSphere:em,orientedBoundingBox:ew,horizonOcclusionPoint:ex}});export{E as default};