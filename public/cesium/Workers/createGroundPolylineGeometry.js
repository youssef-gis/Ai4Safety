import{a as e}from"./chunk-XBWRWNYZ.js";import{a as t}from"./chunk-OXJ2LJUE.js";import{a as n}from"./chunk-OFCC6BNI.js";import{a as i}from"./chunk-FWF3VNA2.js";import{a as r}from"./chunk-AZLP5742.js";import{a as a}from"./chunk-5HPISDSZ.js";import{b as o}from"./chunk-HSJ6GSLC.js";import{a as l}from"./chunk-SXKYZMEL.js";import{c as s,d as u}from"./chunk-EDF5FKWJ.js";import{a as c,d as p}from"./chunk-XQIJGAVD.js";import{e as h,f as d,g as f,i as g}from"./chunk-UTYWXSQT.js";import{a as m}from"./chunk-RCHWDG3R.js";import"./chunk-4WJUWBRK.js";import"./chunk-5G23AKP3.js";import{a as w,b as y,c as T,d as _,e as k,f as O}from"./chunk-KWAHJ72S.js";import{a as E}from"./chunk-MKDADUG3.js";import{a as L,b as A}from"./chunk-NOIUI5SY.js";import{e as P}from"./chunk-XRRBRTKL.js";function S(e){e=e??O.EMPTY_OBJECT,this._ellipsoid=e.ellipsoid??_.default,this._rectangle=e.rectangle??g.MAX_VALUE,this._projection=new c(this._ellipsoid),this._numberOfLevelZeroTilesX=e.numberOfLevelZeroTilesX??2,this._numberOfLevelZeroTilesY=e.numberOfLevelZeroTilesY??1}Object.defineProperties(S.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),S.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},S.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},S.prototype.rectangleToNativeRectangle=function(e,t){A.defined("rectangle",e);let n=E.toDegrees(e.west),i=E.toDegrees(e.south),r=E.toDegrees(e.east),a=E.toDegrees(e.north);return P(t)?(t.west=n,t.south=i,t.east=r,t.north=a,t):new g(n,i,r,a)},S.prototype.tileXYToNativeRectangle=function(e,t,n,i){let r=this.tileXYToRectangle(e,t,n,i);return r.west=E.toDegrees(r.west),r.south=E.toDegrees(r.south),r.east=E.toDegrees(r.east),r.north=E.toDegrees(r.north),r},S.prototype.tileXYToRectangle=function(e,t,n,i){let r=this._rectangle,a=this.getNumberOfXTilesAtLevel(n),o=this.getNumberOfYTilesAtLevel(n),l=r.width/a,s=e*l+r.west,u=(e+1)*l+r.west,c=r.height/o,p=r.north-t*c,h=r.north-(t+1)*c;return P(i)||(i=new g(s,h,u,p)),i.west=s,i.south=h,i.east=u,i.north=p,i},S.prototype.positionToTileXY=function(e,t,n){let i=this._rectangle;if(!g.contains(i,e))return;let r=this.getNumberOfXTilesAtLevel(t),a=this.getNumberOfYTilesAtLevel(t),o=i.width/r,l=i.height/a,s=e.longitude;i.east<i.west&&(s+=E.TWO_PI);let u=(s-i.west)/o|0;u>=r&&(u=r-1);let c=(i.north-e.latitude)/l|0;return c>=a&&(c=a-1),P(n)?(n.x=u,n.y=c,n):new T(u,c)};var I=new w,b=new w,N=new y,v=new w,x=new w,j=new p,D=new S,H=[new y,new y,new y,new y],M=new T,C={};function R(e){y.fromRadians(e.east,e.north,0,H[0]),y.fromRadians(e.west,e.north,0,H[1]),y.fromRadians(e.east,e.south,0,H[2]),y.fromRadians(e.west,e.south,0,H[3]);let t=0,n=0,i=0,r=0,a=C._terrainHeightsMaxLevel,o;for(o=0;o<=a;++o){let e=!1;for(let t=0;t<4;++t){let n=H[t];if(D.positionToTileXY(n,o,M),0===t)i=M.x,r=M.y;else if(i!==M.x||r!==M.y){e=!0;break}}if(e)break;t=i,n=r}if(0!==o)return{x:t,y:n,level:o>a?a:o-1}}C.initialize=function(){let e=C._initPromise;return P(e)||(e=h.fetchJson(d("Assets/approximateTerrainHeights.json")).then(function(e){C._terrainHeights=e}),C._initPromise=e),e},C.getMinimumMaximumHeights=function(e,t){if(A.defined("rectangle",e),!P(C._terrainHeights))throw new L("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=t??_.default;let n=R(e),i=C._defaultMinTerrainHeight,r=C._defaultMaxTerrainHeight;if(P(n)){let a=`${n.level}-${n.x}-${n.y}`,o=C._terrainHeights[a];P(o)&&(i=o[0],r=o[1]),t.cartographicToCartesian(g.northeast(e,N),I),t.cartographicToCartesian(g.southwest(e,N),b),w.midpoint(b,I,v);let l=t.scaleToGeodeticSurface(v,x);i=P(l)?Math.min(i,-w.distance(v,l)):C._defaultMinTerrainHeight}return{minimumTerrainHeight:i=Math.max(C._defaultMinTerrainHeight,i),maximumTerrainHeight:r}},C.getBoundingSphere=function(e,t){if(A.defined("rectangle",e),!P(C._terrainHeights))throw new L("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=t??_.default;let n=R(e),i=C._defaultMaxTerrainHeight;if(P(n)){let e=`${n.level}-${n.x}-${n.y}`,t=C._terrainHeights[e];P(t)&&(i=t[1])}let r=p.fromRectangle3D(e,t,0);return p.fromRectangle3D(e,t,i,j),p.union(r,j,r)},C._terrainHeightsMaxLevel=6,C._defaultMaxTerrainHeight=9e3,C._defaultMinTerrainHeight=-1e5,C._terrainHeights=void 0,C._initPromise=void 0,Object.defineProperties(C,{initialized:{get:function(){return P(C._terrainHeights)}}});var z=[c,e],Y=z.length,B=Math.cos(E.toRadians(30)),F=Math.cos(E.toRadians(150));function X(e){let n=(e=e??O.EMPTY_OBJECT).positions;if(!P(n)||n.length<2)throw new L("At least two positions are required.");if(P(e.arcType)&&e.arcType!==t.GEODESIC&&e.arcType!==t.RHUMB)throw new L("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=e.width??1,this._positions=n,this.granularity=e.granularity??9999,this.loop=e.loop??!1,this.arcType=e.arcType??t.GEODESIC,this._ellipsoid=_.default,this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(X.prototype,{packedLength:{get:function(){return 1+3*this._positions.length+1+1+1+_.packedLength+1+1}}}),X.setProjectionAndEllipsoid=function(e,t){let n=0;for(let e=0;e<Y;e++)if(t instanceof z[e]){n=e;break}e._projectionIndex=n,e._ellipsoid=t.ellipsoid};var U=new w,G=new w,q=new w;function W(e,t,n,i,r){let a=ee(i,e,0,U),o=ee(i,e,n,G),l=ee(i,t,0,q),s=et(o,a,G),u=et(l,a,q);return w.cross(u,s,r),w.normalize(r,r)}var Z=new y,J=new w,V=new w,K=new w;function $(e,n,r,o,l,s,u,c,p,h,d){let f;if(0===l)return;s===t.GEODESIC?f=new i(e,n,u):s===t.RHUMB&&(f=new a(e,n,u));let g=f.surfaceDistance;if(g<l)return;let m=W(e,n,o,u,K),y=Math.ceil(g/l),T=g/y,_=T,k=y-1,O=c.length;for(let e=0;e<k;e++){let e=f.interpolateUsingSurfaceDistance(_,Z),t=ee(u,e,r,J),n=ee(u,e,o,V);w.pack(m,c,O),w.pack(t,p,O),w.pack(n,h,O),d.push(e.latitude),d.push(e.longitude),O+=3,_+=T}}var Q=new y;function ee(e,t,n,i){return y.clone(t,Q),Q.height=n,y.toCartesian(Q,e,i)}function et(e,t,n){return w.subtract(e,t,n),w.normalize(n,n),n}function en(e,t,n,i){return i=et(e,t,i),i=w.cross(i,n,i),i=w.normalize(i,i),i=w.cross(n,i,i)}X.pack=function(e,t,n){A.typeOf.object("value",e),A.defined("array",t);let i=n??0,r=e._positions,a=r.length;t[i++]=a;for(let e=0;e<a;++e){let n=r[e];w.pack(n,t,i),i+=3}return t[i++]=e.granularity,t[i++]=+!!e.loop,t[i++]=e.arcType,_.pack(e._ellipsoid,t,i),i+=_.packedLength,t[i++]=e._projectionIndex,t[i++]=+!!e._scene3DOnly,t},X.unpack=function(e,t,n){A.defined("array",e);let i=t??0,r=e[i++],a=Array(r);for(let t=0;t<r;t++)a[t]=w.unpack(e,i),i+=3;let o=e[i++],l=1===e[i++],s=e[i++],u=_.unpack(e,i);i+=_.packedLength;let c=e[i++],p=1===e[i++];return P(n)||(n=new X({positions:a})),n._positions=a,n.granularity=o,n.loop=l,n.arcType=s,n._ellipsoid=u,n._projectionIndex=c,n._scene3DOnly=p,n};var ei=new w,er=new w,ea=new w,eo=new w;function el(e,t,n,i,r){let a=et(n,t,eo),o=en(e,t,a,ei),l=en(i,t,a,er);if(E.equalsEpsilon(w.dot(o,l),-1,E.EPSILON5))return r=w.cross(a,o,r),r=w.normalize(r,r);r=w.add(l,o,r),r=w.normalize(r,r);let s=w.cross(a,r,ea);return 0>w.dot(l,s)&&(r=w.negate(r,r)),r}var es=l.fromPointNormal(w.ZERO,w.UNIT_Y),eu=new w,ec=new w,ep=new w,eh=new w,ed=new w,ef=new w,eg=new y,em=new y,ew=new y;X.createGeometry=function(e){let i=!e._scene3DOnly,l=e.loop,c=e._ellipsoid,h=e.granularity,d=e.arcType,f=new z[e._projectionIndex](c),T,_,k=e._positions,O=k.length;2===O&&(l=!1);let L,A,S,I,b=new a(void 0,void 0,c),N,v,x,j=[k[0]];for(_=0;_<O-1;_++)L=k[_],A=k[_+1],P(N=o.lineSegmentPlane(L,A,es,ef))&&!w.equalsEpsilon(N,L,E.EPSILON7)&&!w.equalsEpsilon(N,A,E.EPSILON7)&&(e.arcType===t.GEODESIC?j.push(w.clone(N)):e.arcType===t.RHUMB&&(x=c.cartesianToCartographic(N,eg).longitude,S=c.cartesianToCartographic(L,eg),I=c.cartesianToCartographic(A,em),b.setEndPoints(S,I),v=b.findIntersectionWithLongitude(x,ew),!P(N=c.cartographicToCartesian(v,ef))||w.equalsEpsilon(N,L,E.EPSILON7)||w.equalsEpsilon(N,A,E.EPSILON7)||j.push(w.clone(N)))),j.push(A);l&&(L=k[O-1],A=k[0],P(N=o.lineSegmentPlane(L,A,es,ef))&&!w.equalsEpsilon(N,L,E.EPSILON7)&&!w.equalsEpsilon(N,A,E.EPSILON7)&&(e.arcType===t.GEODESIC?j.push(w.clone(N)):e.arcType===t.RHUMB&&(x=c.cartesianToCartographic(N,eg).longitude,S=c.cartesianToCartographic(L,eg),I=c.cartesianToCartographic(A,em),b.setEndPoints(S,I),v=b.findIntersectionWithLongitude(x,ew),!P(N=c.cartographicToCartesian(v,ef))||w.equalsEpsilon(N,L,E.EPSILON7)||w.equalsEpsilon(N,A,E.EPSILON7)||j.push(w.clone(N)))));let D=j.length,H=Array(D);for(_=0;_<D;_++){let e=y.fromCartesian(j[_],c);e.height=0,H[_]=e}if((D=(H=r(H,y.equalsEpsilon)).length)<2)return;let M=[],R=[],Y=[],F=[],X=eu,U=ec,G=ep,q=eh,Z=ed,J=H[0],V=H[1];for(X=ee(c,H[D-1],0,X),q=ee(c,V,0,q),U=ee(c,J,0,U),G=ee(c,J,1e3,G),Z=l?el(X,U,G,q,Z):W(J,V,1e3,c,Z),w.pack(Z,R,0),w.pack(U,Y,0),w.pack(G,F,0),M.push(J.latitude),M.push(J.longitude),$(J,V,0,1e3,h,d,c,R,Y,F,M),_=1;_<D-1;++_){X=w.clone(U,X),U=w.clone(q,U);let e=H[_];ee(c,e,1e3,G),ee(c,H[_+1],0,q),el(X,U,G,q,Z),T=R.length,w.pack(Z,R,T),w.pack(U,Y,T),w.pack(G,F,T),M.push(e.latitude),M.push(e.longitude),$(H[_],H[_+1],0,1e3,h,d,c,R,Y,F,M)}let K=H[D-1],Q=H[D-2];if(U=ee(c,K,0,U),G=ee(c,K,1e3,G),l){let e=H[0];Z=el(X=ee(c,Q,0,X),U,G,q=ee(c,e,0,q),Z)}else Z=W(Q,K,1e3,c,Z);if(T=R.length,w.pack(Z,R,T),w.pack(U,Y,T),w.pack(G,F,T),M.push(K.latitude),M.push(K.longitude),l){for($(K,J,0,1e3,h,d,c,R,Y,F,M),T=R.length,_=0;_<3;++_)R[T+_]=R[_],Y[T+_]=Y[_],F[T+_]=F[_];M.push(J.latitude),M.push(J.longitude)}return function(e,t,i,r,a,o,l){let c,h,d,f=t._ellipsoid,y=i.length/3-1,T=8*y,_=4*T,k=36*y,O=T>65535?new Uint32Array(k):new Uint16Array(k),L=new Float64Array(3*T),A=new Float32Array(_),P=new Float32Array(_),S=new Float32Array(_),I=new Float32Array(_),b=new Float32Array(_),N,v,x,j;l&&(N=new Float32Array(_),v=new Float32Array(_),x=new Float32Array(_),j=new Float32Array(2*T));let D=o.length/2,H=0;ev.height=0,ex.height=0;let M=ej,R=eD;if(l)for(d=0,h=1;h<D;h++)ev.latitude=o[d],ev.longitude=o[d+1],ex.latitude=o[d+2],ex.longitude=o[d+3],M=t.project(ev,M),R=t.project(ex,R),H+=w.distance(M,R),d+=2;let z=r.length/3;R=w.unpack(r,0,R);let Y=0;for(d=3,h=1;h<z;h++)M=w.clone(R,M),R=w.unpack(r,d,R),Y+=w.distance(M,R),d+=3;d=3;let F=0,X=0,U=0,G=0,q=!1,W=w.unpack(i,0,eM),Z=w.unpack(r,0,eD),J=w.unpack(a,0,eR);e&&ek(J,w.unpack(i,i.length-6,eH),W,Z)&&(J=w.negate(J,J));let V=0,K=0,$=0;for(h=0;h<y;h++){let e,s,u,p,h=w.clone(W,eH),m=w.clone(Z,ej),y=w.clone(J,eC);if(q&&(y=w.negate(y,y)),W=w.unpack(i,d,eM),Z=w.unpack(r,d,eD),q=ek(J=w.unpack(a,d,eR),h,W,Z),ev.latitude=o[F],ev.longitude=o[F+1],ex.latitude=o[F+2],ex.longitude=o[F+3],l){let n=function(e,t){let n=Math.abs(e.longitude),i=Math.abs(t.longitude);return E.equalsEpsilon(n,E.PI,E.EPSILON11)?(e.longitude=E.sign(t.longitude)*(n-E.EPSILON11),1):E.equalsEpsilon(i,E.PI,E.EPSILON11)?(t.longitude=E.sign(e.longitude)*(i-E.EPSILON11),2):0}(ev,ex);e=t.project(ev,eG);let i=et(s=t.project(ex,eq),e,e2);i.y=Math.abs(i.y),u=eW,p=eZ,0===n||w.dot(i,w.UNIT_Y)>B?(u=eA(t,ev,y,e,eW),p=eA(t,ex,J,s,eZ)):1===n?(p=eA(t,ex,J,s,eZ),u.x=0,u.y=E.sign(ev.longitude-Math.abs(ex.longitude)),u.z=0):(u=eA(t,ev,y,e,eW),p.x=0,p.y=E.sign(ev.longitude-ex.longitude),p.z=0)}let T=w.distance(m,Z),_=n.fromCartesian(h,e1),k=w.subtract(W,h,eJ),O=w.normalize(k,e$),D=w.subtract(m,h,eV);D=w.normalize(D,D);let M=w.cross(O,D,e$);M=w.normalize(M,M);let R=w.cross(D,y,eQ);R=w.normalize(R,R);let z=w.subtract(Z,W,eK);z=w.normalize(z,z);let Q=w.cross(J,z,e0);Q=w.normalize(Q,Q);let ee=T/Y,en=V/Y,ei=0,er,ea,eo,el=0,es=0;if(l){ei=w.distance(e,s),er=n.fromCartesian(e,e3),ea=w.subtract(s,e,e2);let t=(eo=w.normalize(ea,e5)).x;eo.x=eo.y,eo.y=-t,el=ei/H,es=K/H}for(c=0;c<8;c++){let e=G+4*c,t=X+2*c,n=e+3,i=c<4?1:-1,r=2===c||3===c||6===c||7===c?1:-1;w.pack(_.high,A,e),A[n]=k.x,w.pack(_.low,P,e),P[n]=k.y,w.pack(R,S,e),S[n]=k.z,w.pack(Q,I,e),I[n]=ee*i,w.pack(M,b,e);let a=en*r;0===a&&r<0&&(a=9),b[n]=a,l&&(N[e]=er.high.x,N[e+1]=er.high.y,N[e+2]=er.low.x,N[e+3]=er.low.y,x[e]=-u.y,x[e+1]=u.x,x[e+2]=p.y,x[e+3]=-p.x,v[e]=ea.x,v[e+1]=ea.y,v[e+2]=eo.x,v[e+3]=eo.y,j[t]=el*i,0==(a=es*r)&&r<0&&(a=9),j[t+1]=a)}let eu=g.fromCartographicArray(ez,eY),ec=C.getMinimumMaximumHeights(eu,f),ep=ec.minimumTerrainHeight,eh=ec.maximumTerrainHeight;$+=Math.abs(ep),$+=Math.abs(eh),eI(h,m,ep,eh,eX,eB),eI(W,Z,ep,eh,eU,eF);let ed=w.multiplyByScalar(M,E.EPSILON5,e7);w.add(eX,ed,eX),w.add(eU,ed,eU),w.add(eB,ed,eB),w.add(eF,ed,eF),eN(eX,eU),eN(eB,eF),w.pack(eX,L,U),w.pack(eU,L,U+3),w.pack(eF,L,U+6),w.pack(eB,L,U+9),ed=w.multiplyByScalar(M,-2*E.EPSILON5,e7),w.add(eX,ed,eX),w.add(eU,ed,eU),w.add(eB,ed,eB),w.add(eF,ed,eF),eN(eX,eU),eN(eB,eF),w.pack(eX,L,U+12),w.pack(eU,L,U+15),w.pack(eF,L,U+18),w.pack(eB,L,U+21),F+=2,d+=3,X+=16,U+=24,G+=32,V+=T,K+=ei}d=0;let Q=0;for(h=0;h<y;h++){for(c=0;c<e9;c++)O[d+c]=e4[c]+Q;Q+=8,d+=e9}p.fromVertices(i,w.ZERO,3,e6[0]),p.fromVertices(r,w.ZERO,3,e6[1]);let ee=p.fromBoundingSpheres(e6);ee.radius+=$/(2*y);let en={position:new u({componentDatatype:m.DOUBLE,componentsPerAttribute:3,normalize:!1,values:L}),startHiAndForwardOffsetX:e8(A),startLoAndForwardOffsetY:e8(P),startNormalAndForwardOffsetZ:e8(S),endNormalAndTextureCoordinateNormalizationX:e8(I),rightNormalAndTextureCoordinateNormalizationY:e8(b)};return l&&(en.startHiLo2D=e8(N),en.offsetAndRight2D=e8(v),en.startEndNormals2D=e8(x),en.texcoordNormalization2D=new u({componentDatatype:m.FLOAT,componentsPerAttribute:2,normalize:!1,values:j})),new s({attributes:en,indices:O,boundingSphere:ee})}(l,f,Y,F,R,M,i)};var ey=new w,eT=new k,e_=new f;function ek(e,t,n,i){let r=et(n,t,ey),a=w.dot(r,e);if(a>B||a<F){let t=et(i,n,eo),r=a<F?E.PI_OVER_TWO:-E.PI_OVER_TWO,o=f.fromAxisAngle(t,r,e_),l=k.fromQuaternion(o,eT);return k.multiplyByVector(l,e,e),!0}return!1}var eO=new y,eE=new w,eL=new w;function eA(e,t,n,i,r){let a=y.toCartesian(t,e._ellipsoid,eE),o=w.add(a,n,eL),l=!1,s=e._ellipsoid,u=s.cartesianToCartographic(o,eO);Math.abs(t.longitude-u.longitude)>E.PI_OVER_TWO&&(l=!0,o=w.subtract(a,n,eL),u=s.cartesianToCartographic(o,eO)),u.height=0;let c=e.project(u,r);return(r=w.subtract(c,i,r)).z=0,r=w.normalize(r,r),l&&w.negate(r,r),r}var eP=new w,eS=new w;function eI(e,t,n,i,r,a){let o=w.subtract(t,e,eP);w.normalize(o,o);let l=w.multiplyByScalar(o,n-0,eS);w.add(e,l,r),l=w.multiplyByScalar(o,i-1e3,eS),w.add(t,l,a)}var eb=new w;function eN(e,t){let n=l.getPointDistance(es,e),i=l.getPointDistance(es,t),r=eb;E.equalsEpsilon(n,0,E.EPSILON2)?(r=et(t,e,r),w.multiplyByScalar(r,E.EPSILON2,r),w.add(e,r,e)):E.equalsEpsilon(i,0,E.EPSILON2)&&(r=et(e,t,r),w.multiplyByScalar(r,E.EPSILON2,r),w.add(t,r,t))}var ev=new y,ex=new y,ej=new w,eD=new w,eH=new w,eM=new w,eC=new w,eR=new w,ez=[ev,ex],eY=new g,eB=new w,eF=new w,eX=new w,eU=new w,eG=new w,eq=new w,eW=new w,eZ=new w,eJ=new w,eV=new w,eK=new w,e$=new w,eQ=new w,e0=new w,e1=new n,e3=new n,e2=new w,e5=new w,e7=new w,e6=[new p,new p],e4=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],e9=e4.length;function e8(e){return new u({componentDatatype:m.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}X._projectNormal=eA;var te=function(e,t){return C.initialize().then(function(){return P(t)&&(e=X.unpack(e,t)),X.createGeometry(e)})};export{te as default};