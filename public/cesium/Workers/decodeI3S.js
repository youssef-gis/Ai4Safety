import{a as e}from"./chunk-DK73HV33.js";import{a as t}from"./chunk-GTQ3WXPT.js";import{a as n}from"./chunk-D2NFCOGE.js";import{a as r}from"./chunk-XBWRWNYZ.js";import{a as o,b as a,d as i,e as l}from"./chunk-KWAHJ72S.js";import{a as s}from"./chunk-MKDADUG3.js";import{b as u}from"./chunk-NOIUI5SY.js";import{d as f,e as c}from"./chunk-XRRBRTKL.js";var h,y=f(e(),1),p=function(e){return u.defined("value",e),e<=.04045?.07739938080495357*e:Math.pow((e+.055)*.9478672985781991,2.4)};function g(e,t,n){for(let l=0;l<n.length;l++){let s=n[l].nativeExtent,u=new o;if("WebMercator"===n[l].projectionType){let o=n[l].projection._ellipsoid._radii;u=new r(new i(o.x,o.y,o.z)).project(new a(e,t,0))}else u.x=e,u.y=t;if(u.x>s.west&&u.x<s.east&&u.y>s.south&&u.y<s.north)return function(e,t,n){var r,o,a,i,l,s,u,f,c,h;let y=n.nativeExtent,p=(e-y.west)/(y.east-y.west)*(n.width-1),g=(t-y.south)/(y.north-y.south)*(n.height-1),b=Math.floor(p),d=Math.floor(g);p-=b,g-=d;let m=b<n.width?b+1:b,w=d<n.height?d+1:d;d=n.height-1-d,w=n.height-1-w;let A=(r=d,o=n.width,n.buffer[b+r*o]),x=(a=d,i=n.width,n.buffer[m+a*i]),v=(l=w,s=n.width,n.buffer[b+l*s]),L=(u=w,f=n.width,n.buffer[m+u*f]);return((A*(1-(c=p))+x*c)*(1-(h=g))+(v*(1-c)+L*c)*h)*n.scale+n.offset}(u.x,u.y,n[l])}return 0}var b=new o,d=new o,m=new o;function w(e,t,n,r){let a=3*n[t],i=3*n[t+1],l=3*n[t+2];o.fromArray(r,a,b),o.fromArray(r,i,d),o.fromArray(r,l,m),o.subtract(d,b,d),o.subtract(m,b,m),o.cross(d,m,b);let s=o.magnitude(b);0!==s&&o.divideByScalar(b,s,b),o.pack(b,e,3*t),o.pack(b,e,(t+1)*3),o.pack(b,e,(t+2)*3)}var A=new o,x=new o,v={position:function(e,t,n){let r=3*e.vertexCount;return e.positions=new Float32Array(t,n,r),n+=4*r},normal:function(e,t,n){let r=3*e.vertexCount;return e.normals=new Float32Array(t,n,r),n+=4*r},uv0:function(e,t,n){let r=2*e.vertexCount;return e.uv0s=new Float32Array(t,n,r),n+=4*r},color:function(e,t,n){let r=4*e.vertexCount;return e.colors=new Uint8Array(t,n,r),n+=r},featureId:function(e,t,n){return n+8*e.featureCount},id:function(e,t,n){return n+8*e.featureCount},faceRange:function(e,t,n){let r=2*e.featureCount;return e.faceRange=new Uint32Array(t,n,r),n+=4*r},uvRegion:function(e,t,n){let r=4*e.vertexCount;return e["uv-region"]=new Uint16Array(t,n,r),n+=2*r},region:function(e,t,n){let r=4*e.vertexCount;return e["uv-region"]=new Uint16Array(t,n,r),n+=2*r}};async function L(e,t){let n=e.webAssemblyConfig;return h=c(n)&&c(n.wasmBinaryFile)?await (0,y.default)(n):await (0,y.default)(),!0}var C=n(function(e,n){return c(e.webAssemblyConfig)?L(e,n):function(e){var n,r,u,f;let y,b,d=(n=e.binaryData,r=e.schema,u=e.bufferInfo,f=e.featureData,68===(y=new Uint8Array(n,0,5))[0]&&82===y[1]&&65===y[2]&&67===y[3]&&79===y[4]?function(e){let t=h,n=new t.DecoderBuffer,r=new Uint8Array(e);n.Init(r,r.length);let o=new t.Decoder,a=o.GetEncodedGeometryType(n),i=new t.MetadataQuerier,l,s;a===t.TRIANGULAR_MESH&&(l=new t.Mesh,s=o.DecodeBufferToMesh(n,l));let u={vertexCount:[0],featureCount:0};if(c(s)&&s.ok()&&0!==l.ptr){let e=l.num_faces(),n=l.num_attributes(),r=l.num_points();u.indices=new Uint32Array(3*e);let a=u.indices;u.vertexCount[0]=r,u.scale_x=1,u.scale_y=1;let s=new t.DracoInt32Array(3);for(let t=0;t<e;++t)o.GetFaceFromMesh(l,t,s),a[3*t]=s.GetValue(0),a[3*t+1]=s.GetValue(1),a[3*t+2]=s.GetValue(2);t.destroy(s);for(let e=0;e<n;++e){let n=o.GetAttribute(l,e),a=function(e,t,n,r,o){let a=r.num_components()*o,i,l=[function(){},function(){i=new e.DracoInt8Array(a),t.GetAttributeInt8ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Int8Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){i=new e.DracoInt8Array(a),t.GetAttributeUInt8ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Uint8Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){i=new e.DracoInt16Array(a),t.GetAttributeInt16ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Int16Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){i=new e.DracoInt16Array(a),t.GetAttributeUInt16ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Uint16Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){i=new e.DracoInt32Array(a),t.GetAttributeInt32ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Int32Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){i=new e.DracoInt32Array(a),t.GetAttributeUInt32ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Uint32Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){},function(){},function(){i=new e.DracoFloat32Array(a),t.GetAttributeFloatForAllPoints(n,r,i)||console.error("Bad stream");let o=new Float32Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){},function(){i=new e.DracoUInt8Array(a),t.GetAttributeUInt8ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Uint8Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o}][r.data_type()]();return c(i)&&e.destroy(i),l}(t,o,l,n,r),s=n.attribute_type(),f="unknown";s===t.POSITION?f="positions":s===t.NORMAL?f="normals":s===t.COLOR?f="colors":s===t.TEX_COORD&&(f="uv0s");let h=o.GetAttributeMetadata(l,e);if(0!==h.ptr){let e=i.NumEntries(h);for(let t=0;t<e;++t){let e=i.GetEntryName(h,t);"i3s-scale_x"===e?u.scale_x=i.GetDoubleEntry(h,"i3s-scale_x"):"i3s-scale_y"===e?u.scale_y=i.GetDoubleEntry(h,"i3s-scale_y"):"i3s-attribute-type"===e&&(f=i.GetStringEntry(h,"i3s-attribute-type"))}}c(u[f])&&console.log("Attribute already exists",f),u[f]=a,"feature-index"===f&&u.featureCount++}t.destroy(l)}return t.destroy(i),t.destroy(o),u}(n,u):function(e,t,n,r){let o={vertexCount:0},a=new DataView(e);try{let i=0;if(o.vertexCount=a.getUint32(i,1),i+=4,o.featureCount=a.getUint32(i,1),i+=4,c(n))for(let t=0;t<n.attributes.length;t++)c(v[n.attributes[t]])?i=v[n.attributes[t]](o,e,i):console.error("Unknown decoder for",n.attributes[t]);else{let n=t.ordering,a=t.featureAttributeOrder;c(r)&&c(r.geometryData)&&c(r.geometryData[0])&&c(r.geometryData[0].params)&&(n=Object.keys(r.geometryData[0].params.vertexAttributes),a=Object.keys(r.geometryData[0].params.featureAttributes));for(let t=0;t<n.length;t++)i=(0,v[n[t]])(o,e,i);for(let t=0;t<a.length;t++)i=(0,v[a[t]])(o,e,i)}}catch(e){console.error(e)}return o.scale_x=1,o.scale_y=1,o}(n,r,u,f));if(c(e.geoidDataList)&&e.geoidDataList.length>0&&function(e,t,n,r,o,a,i){if(i)return;let l=g(o.longitude,o.latitude,a);for(let i=0;i<e;++i){let e=g(o.longitude+s.toRadians(n*t[3*i]),o.latitude+s.toRadians(r*t[3*i+1]),a);t[3*i+2]+=e-l}}(d.vertexCount,d.positions,d.scale_x,d.scale_y,e.cartographicCenter,e.geoidDataList,!1),function(e,t,n,r,u,f,h,y,p){if(0===e||!c(t)||0===t.length)return;let g=new i(Math.sqrt(h.x),Math.sqrt(h.y),Math.sqrt(h.z));for(let i=0;i<e;++i){let e=3*i,h=e+1,b=e+2,d=new a;d.longitude=r.longitude+s.toRadians(y*t[e]),d.latitude=r.latitude+s.toRadians(p*t[h]),d.height=r.height+t[b];let m={};g.cartographicToCartesian(d,m),m.x-=u.x,m.y-=u.y,m.z-=u.z;let w={};if(l.multiplyByVector(f,m,w),t[e]=w.x,t[h]=w.y,t[b]=w.z,c(n)){let t=new o(n[e],n[h],n[b]),r={};l.multiplyByVector(f,t,r),n[e]=r.x,n[h]=r.y,n[b]=r.z}}}(d.vertexCount,d.positions,d.normals,e.cartographicCenter,e.cartesianCenter,e.parentRotation,e.ellipsoidRadiiSquare,d.scale_x,d.scale_y),c(d.uv0s)&&c(d["uv-region"])&&function(e,t,n){for(let r=0;r<e;++r){let e=n[4*r]/65535,o=n[4*r+1]/65535,a=(n[4*r+2]-n[4*r])/65535,i=(n[4*r+3]-n[4*r+1])/65535;t[2*r]*=a,t[2*r]+=e,t[2*r+1]*=i,t[2*r+1]+=o}}(d.vertexCount,d.uv0s,d["uv-region"]),c(d["feature-index"]))b=d["feature-index"];else if(c(d.faceRange)){b=Array(d.vertexCount);for(let e=0;e<d.faceRange.length-1;e+=2){let t=e/2,n=d.faceRange[e],r=d.faceRange[e+1];for(let e=n;e<=r;e++)b[3*e]=t,b[3*e+1]=t,b[3*e+2]=t}}if(e.calculateNormals){let e=function(e,t,n,r,o,a,i){let l={normals:void 0,positions:void 0,uv0s:void 0,colors:void 0,featureIndex:void 0,vertexCount:void 0};if(0===e||!c(n)||0===n.length||c(r))return l;if(c(t)){l.vertexCount=t.length,l.positions=new Float32Array(3*t.length),l.uv0s=c(o)?new Float32Array(2*t.length):void 0,l.colors=c(a)?new Uint8Array(4*t.length):void 0,l.featureIndex=c(i)?Array(t.length):void 0;for(let e=0;e<t.length;e++){let r=t[e];l.positions[3*e]=n[3*r],l.positions[3*e+1]=n[3*r+1],l.positions[3*e+2]=n[3*r+2],c(l.uv0s)&&(l.uv0s[2*e]=o[2*r],l.uv0s[2*e+1]=o[2*r+1]),c(l.colors)&&(l.colors[4*e]=a[4*r],l.colors[4*e+1]=a[4*r+1],l.colors[4*e+2]=a[4*r+2],l.colors[4*e+3]=a[4*r+3]),c(l.featureIndex)&&(l.featureIndex[e]=i[r])}e=t.length,n=l.positions}t=Array(e);for(let n=0;n<e;n++)t[n]=n;l.normals=new Float32Array(3*t.length);for(let e=0;e<t.length;e+=3)w(l.normals,e,t,n);return l}(d.vertexCount,d.indices,d.positions,d.normals,d.uv0s,d.colors,b);c(e.normals)&&(d.normals=e.normals,c(e.vertexCount)&&(d.vertexCount=e.vertexCount,d.indices=e.indices,d.positions=e.positions,d.uv0s=e.uv0s,d.colors=e.colors,b=e.featureIndex))}let m=function(e,n,r,a,i,l,s,u){if(0===e||!c(r)||0===r.length)return{buffers:[],bufferViews:[],accessors:[],meshes:[],nodes:[],nodesInScene:[]};let f=[],h=[],y=[],g=[],b=[],d=[],m={},v=[];c(n)&&(e=n.length);let{indexArray:L,transparentVertexOffset:C}=function(e,t,n,r){let o=new Uint32Array(e),a=c(t)?e=>t[e]:e=>e,i=0;if(r&&c(n)){let t=e=>n[4*a(e)+3]<255;for(let n=0;n<e;n+=3)t(n)||t(n+1)||t(n+2)||(o[i++]=a(n),o[i++]=a(n+1),o[i++]=a(n+2));if(i>0){let n=i;for(let r=0;r<e;r+=3)(t(r)||t(r+1)||t(r+2))&&(o[n++]=a(r),o[n++]=a(r+1),o[n++]=a(r+2))}else for(let t=0;t<e;++t)o[t]=a(t)}else{i=e;for(let t=0;t<e;++t)o[t]=a(t)}return{indexArray:o,transparentVertexOffset:i}}(e,n,l,u.splitGeometryByColorTransparency),O=new Blob([L],{type:"application/binary"}),R=URL.createObjectURL(O),I=e,U=u.enableFeatures&&c(s)?new Float32Array(s.length):void 0,_=0;if(c(U))for(let e=0;e<s.length;++e){U[e]=s[e];let t=s[e]+1;_<t&&(_=t)}let T,D=function(e,t,n,r,a){if(!c(e)||0===Object.keys(e).length)return;let i=function(e,t,n,r){let o=[];for(let a=0;a<n.length;a+=3){let i=function(e,t,n){let r=t[n];if(c(r))return r;let o=t[n]={positions:{},indices:{},edges:{}},a=e[n]??e.default;return o.hasOutline=c(a?.edges),o}(e,o,c(t)?t[n[a]]:"default");if(!i.hasOutline)continue;let l=i.indices,s=i.positions;for(let e=0;e<3;e++){let t=n[a+e];if(!c(l[t])){let e=3*t,n=s;for(let t=0;t<3;t++){let o=r[e+t];c(n[o])||(n[o]={}),n=n[o]}c(n.index)||(n.index=t),l[t]=n.index}}let u=i.edges;for(let e=0;e<3;e++){let t=n[a+e],r=n[a+(e+1)%3],o=l[t],i=l[r];!function(e,t,n,r,o,a){let i,l;r<o?(i=r,l=o):(i=o,l=r);let s=e[i];c(s)||(s=e[i]={});let u=s[l];c(u)||(u=s[l]={normalsIndex:[],outlines:[]}),u.normalsIndex.push(a),(0===u.outlines.length||t!==r||n!==o)&&u.outlines.push(t,n)}(u,t,r,o,i,a)}}return o}(e,t,n,r);c(a)&&3*n.length===a.length||(a=[]);let l=function(e,t,n,r){let a=[],i=Object.keys(e);for(let l=0;l<i.length;l++)!function(e,t,n,r,a){let i=Object.keys(t);for(let l=0;l<i.length;l++){let s=t[i[l]],u=Object.keys(s);for(let t=0;t<u.length;t++)!function(e,t,n,r,a){if(t.normalsIndex.length>1){let e=r.length===a.length;for(let i=0;i<t.normalsIndex.length;i++){let l=t.normalsIndex[i];if(c(a[3*l])||w(a,l,n,r),0!==i)for(let r=0;r<i;r++){let i=t.normalsIndex[r];if(function(e,t,n){o.fromArray(e,t,A),o.fromArray(e,n,x);let r=o.dot(A,x);return .25>Math.atan2(o.magnitude(o.cross(A,x,A)),r)}(a,e?3*n[l]:3*l,e?3*n[i]:3*i))return}}}e.push(...t.outlines)}(e,s[u[t]],n,r,a)}}(a,e[i[l]].edges,t,n,r);return a}(i,n,r,a);return l.length>0?new Uint32Array(l):void 0}(u.symbologyData,s,L,r,a);if(c(D)){let e=new Blob([D],{type:"application/binary"});T=URL.createObjectURL(e)}let G=r.subarray(0,3*I),F=new Blob([G],{type:"application/binary"}),V=URL.createObjectURL(F),j=1/0,B=-1/0,E=1/0,M=-1/0,k=1/0,S=-1/0;for(let e=0;e<G.length/3;e++)j=Math.min(j,G[3*e+0]),B=Math.max(B,G[3*e+0]),E=Math.min(E,G[3*e+1]),M=Math.max(M,G[3*e+1]),k=Math.min(k,G[3*e+2]),S=Math.max(S,G[3*e+2]);let N=a?a.subarray(0,3*I):void 0,P;if(c(N)){let e=new Blob([N],{type:"application/binary"});P=URL.createObjectURL(e)}let X=i?i.subarray(0,2*I):void 0,z;if(c(X)){let e=new Blob([X],{type:"application/binary"});z=URL.createObjectURL(e)}let q=c(l)?function(e){let n=new Float32Array(e.length);for(let r=0;r<e.length;r+=4)n[r]=p(t.byteToFloat(e[r])),n[r+1]=p(t.byteToFloat(e[r+1])),n[r+2]=p(t.byteToFloat(e[r+2])),n[r+3]=t.byteToFloat(e[r+3]);return n}(l.subarray(0,4*I)):void 0,W;if(c(q)){let e=new Blob([q],{type:"application/binary"});W=URL.createObjectURL(e)}let K=c(U)?U.subarray(0,I):void 0,H;if(c(K)){let e=new Blob([K],{type:"application/binary"});H=URL.createObjectURL(e)}let Q=c(U)?new Float32Array(_):void 0,Y;if(c(Q)){for(let e=0;e<Q.length;++e)Q[e]=e;let e=new Blob([Q],{type:"application/binary"});Y=URL.createObjectURL(e)}let J={},Z={};J.POSITION=y.length,f.push({uri:V,byteLength:G.byteLength}),h.push({buffer:f.length-1,byteOffset:0,byteLength:G.byteLength,target:34962}),y.push({bufferView:h.length-1,byteOffset:0,componentType:5126,count:G.length/3,type:"VEC3",max:[j,E,k],min:[B,M,S]}),c(P)&&(J.NORMAL=y.length,f.push({uri:P,byteLength:N.byteLength}),h.push({buffer:f.length-1,byteOffset:0,byteLength:N.byteLength,target:34962}),y.push({bufferView:h.length-1,byteOffset:0,componentType:5126,count:N.length/3,type:"VEC3"})),c(z)&&(J.TEXCOORD_0=y.length,f.push({uri:z,byteLength:X.byteLength}),h.push({buffer:f.length-1,byteOffset:0,byteLength:X.byteLength,target:34962}),y.push({bufferView:h.length-1,byteOffset:0,componentType:5126,count:X.length/2,type:"VEC2"})),c(W)&&(J.COLOR_0=y.length,f.push({uri:W,byteLength:q.byteLength}),h.push({buffer:f.length-1,byteOffset:0,byteLength:q.byteLength,target:34962}),y.push({bufferView:h.length-1,byteOffset:0,componentType:5126,count:q.length/4,type:"VEC4"})),c(H)&&(J._FEATURE_ID_0=y.length,f.push({uri:H,byteLength:K.byteLength}),h.push({buffer:f.length-1,byteOffset:0,byteLength:K.byteLength,target:34963}),y.push({bufferView:h.length-1,byteOffset:0,componentType:5126,count:K.length,type:"SCALAR"}),Z.EXT_mesh_features={featureIds:[{attribute:0,propertyTable:0,featureCount:_}]},v.push("EXT_mesh_features")),c(Y)&&(f.push({uri:Y,byteLength:Q.byteLength}),h.push({buffer:f.length-1,byteOffset:0,byteLength:Q.byteLength,target:34963}),m.EXT_structural_metadata={schema:{id:"i3s-metadata-schema-001",name:"I3S metadata schema 001",description:"The schema for I3S metadata",version:"1.0",classes:{feature:{name:"feature",description:"Feature metadata",properties:{index:{description:"The feature index",type:"SCALAR",componentType:"FLOAT32",required:!0}}}}},propertyTables:[{name:"feature-indices-mapping",class:"feature",count:_,properties:{index:{values:h.length-1}}}]},v.push("EXT_structural_metadata")),c(T)&&(f.push({uri:T,byteLength:D.byteLength}),h.push({buffer:f.length-1,byteOffset:0,byteLength:D.byteLength,target:34963}),y.push({bufferView:h.length-1,byteOffset:0,componentType:5125,count:D.length,type:"SCALAR"}),Z.CESIUM_primitive_outline={indices:y.length-1},v.push("CESIUM_primitive_outline")),f.push({uri:R,byteLength:L.byteLength}),h.push({buffer:f.length-1,byteOffset:0,byteLength:L.byteLength,target:34963});let $=[];return C>0&&(y.push({bufferView:h.length-1,byteOffset:0,componentType:5125,count:C,type:"SCALAR"}),$.push({attributes:J,indices:y.length-1,material:$.length,extensions:Z})),C<e&&(y.push({bufferView:h.length-1,byteOffset:4*C,componentType:5125,count:e-C,type:"SCALAR"}),$.push({attributes:J,indices:y.length-1,material:$.length,extensions:Z,extra:{isTransparent:!0}})),g.push({primitives:$}),d.push(0),b.push({mesh:0}),{buffers:f,bufferViews:h,accessors:y,meshes:g,nodes:b,nodesInScene:d,rootExtensions:m,extensionsUsed:v}}(d.vertexCount,d.indices,d.positions,d.normals,d.uv0s,d.colors,b,e);return m._customAttributes={positions:d.positions,indices:d.indices,featureIndex:b,sourceURL:e.url,cartesianCenter:e.cartesianCenter,parentRotation:e.parentRotation},{meshData:m}}(e,n)});export{C as default};