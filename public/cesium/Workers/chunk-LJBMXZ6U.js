import{a as e}from"./chunk-XBWRWNYZ.js";import{a as t}from"./chunk-3BSRJTW3.js";import{a as r}from"./chunk-T6Q6HX5J.js";import{a as n}from"./chunk-4MJDNHOT.js";import{c as o,d as i}from"./chunk-EDF5FKWJ.js";import{a as s,d as a}from"./chunk-XQIJGAVD.js";import{b as l}from"./chunk-UTYWXSQT.js";import{a as c}from"./chunk-RCHWDG3R.js";import{d as u}from"./chunk-KWAHJ72S.js";import{a as p,b as f}from"./chunk-NOIUI5SY.js";import{e as m}from"./chunk-XRRBRTKL.js";function h(e,t,r){e=e??0,t=t??0,r=r??0,this.value=new Float32Array([e,t,r])}function d(e,t){let r=e.attributes,n=r.position,o=n.values.length/n.componentsPerAttribute;r.batchId=new i({componentDatatype:c.FLOAT,componentsPerAttribute:1,values:new Float32Array(o)});let s=r.batchId.values;for(let e=0;e<o;++e)s[e]=t}function g(e,t,r,n){let o,i,s,a=n.length-1;if(a>=0){let e=n[a];o=e.offset+e.count,i=r[s=e.index].indices.length}else o=0,i=r[s=0].indices.length;let l=e.length;for(let a=0;a<l;++a){let l=e[a][t];if(!m(l))continue;let c=l.indices.length;o+c>i&&(o=0,i=r[++s].indices.length),n.push({index:s,offset:o,count:c}),o+=c}}Object.defineProperties(h.prototype,{componentDatatype:{get:function(){return c.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}}),h.fromCartesian3=function(e){return f.defined("offset",e),new h(e.x,e.y,e.z)},h.toValue=function(e,t){return f.defined("offset",e),m(t)||(t=new Float32Array([e.x,e.y,e.z])),t[0]=e.x,t[1]=e.y,t[2]=e.z,t};var y={};function b(e){let t=e.length,r=new Float32Array(1+(a.packedLength+1)*t),n=0;r[n++]=t;for(let o=0;o<t;++o)m(e[o])?(r[n++]=1,a.pack(e[o],r,n)):r[n++]=0,n+=a.packedLength;return r}function k(e){let t=Array(e[0]),r=0,n=1;for(;n<e.length;)1===e[n++]&&(t[r]=a.unpack(e,n)),++r,n+=a.packedLength;return t}y.combineGeometry=function(e){var r;let n,o,i,s=e.instances,u=s.length,f,h,y=!1;u>0&&((o=function(e){let r=e.instances,n=e.projection,o=e.elementIndexUintSupported,i=e.scene3DOnly,s=e.vertexCacheOptimize,u=e.compressVertices,f=e.modelMatrix,h,g,y,b=r.length;for(h=0;h<b;++h)if(m(r[h].geometry)){y=r[h].geometry.primitiveType;break}for(h=1;h<b;++h)if(m(r[h].geometry)&&r[h].geometry.primitiveType!==y)throw new p("All instance geometries must have the same primitiveType.");if(function(e,r,n){let o=!n,i=e.length,s;if(!o&&i>1){let t=e[0].modelMatrix;for(s=1;s<i;++s)if(!l.equals(t,e[s].modelMatrix)){o=!0;break}}if(o)for(s=0;s<i;++s)m(e[s].geometry)&&t.transformToWorldCoordinates(e[s]);else l.multiplyTransformation(r,e[0].modelMatrix,r)}(r,f,i),!i)for(h=0;h<b;++h)m(r[h].geometry)&&t.splitLongitude(r[h]);if(function(e){let t=e.length;for(let r=0;r<t;++r){let t=e[r];m(t.geometry)?d(t.geometry,r):m(t.westHemisphereGeometry)&&m(t.eastHemisphereGeometry)&&(d(t.westHemisphereGeometry,r),d(t.eastHemisphereGeometry,r))}}(r),s)for(h=0;h<b;++h){let e=r[h];m(e.geometry)?(t.reorderForPostVertexCache(e.geometry),t.reorderForPreVertexCache(e.geometry)):m(e.westHemisphereGeometry)&&m(e.eastHemisphereGeometry)&&(t.reorderForPostVertexCache(e.westHemisphereGeometry),t.reorderForPreVertexCache(e.westHemisphereGeometry),t.reorderForPostVertexCache(e.eastHemisphereGeometry),t.reorderForPreVertexCache(e.eastHemisphereGeometry))}let k=t.combineInstances(r);for(b=k.length,h=0;h<b;++h){let e=(g=k[h]).attributes;if(i)for(let r in e)e.hasOwnProperty(r)&&e[r].componentDatatype===c.DOUBLE&&t.encodeAttribute(g,r,`${r}3DHigh`,`${r}3DLow`);else for(let r in e)if(e.hasOwnProperty(r)&&e[r].componentDatatype===c.DOUBLE){let e=`${r}3D`,o=`${r}2D`;t.projectTo2D(g,r,e,o,n),m(g.boundingSphere)&&"position"===r&&(g.boundingSphereCV=a.fromVertices(g.attributes.position2D.values)),t.encodeAttribute(g,e,`${e}High`,`${e}Low`),t.encodeAttribute(g,o,`${o}High`,`${o}Low`)}u&&t.compressVertices(g)}if(!o){let e=[];for(b=k.length,h=0;h<b;++h)g=k[h],e=e.concat(t.fitToUnsignedShortIndices(g));k=e}return k}(e)).length>0&&(i=t.createAttributeLocations(o[0]),e.createPickOffsets&&(n=[],g(s,"geometry",r=o,n),g(s,"westHemisphereGeometry",r,n),g(s,"eastHemisphereGeometry",r,n),f=n)),m(s[0].attributes)&&m(s[0].attributes.offset)&&(h=Array(u),y=!0));let b=Array(u),k=Array(u);for(let e=0;e<u;++e){let t=s[e],r=t.geometry;m(r)&&(b[e]=r.boundingSphere,k[e]=r.boundingSphereCV,y&&(h[e]=t.geometry.offsetAttribute));let n=t.eastHemisphereGeometry,o=t.westHemisphereGeometry;m(n)&&m(o)&&(m(n.boundingSphere)&&m(o.boundingSphere)&&(b[e]=a.union(n.boundingSphere,o.boundingSphere)),m(n.boundingSphereCV)&&m(o.boundingSphereCV)&&(k[e]=a.union(n.boundingSphereCV,o.boundingSphereCV)))}return{geometries:o,modelMatrix:e.modelMatrix,attributeLocations:i,pickOffsets:f,offsetInstanceExtend:h,boundingSpheres:b,boundingSpheresCV:k}},y.packCreateGeometryResults=function(e,t){let r=new Float64Array(function(e){let t=1,r=e.length;for(let n=0;n<r;n++){let r=e[n];if(++t,!m(r))continue;let o=r.attributes;for(let e in t+=7+2*a.packedLength+(m(r.indices)?r.indices.length:0),o)o.hasOwnProperty(e)&&m(o[e])&&(t+=5+o[e].values.length)}return t}(e)),n=[],o={},i=e.length,s=0;r[s++]=i;for(let t=0;t<i;t++){let i=e[t],l=m(i);if(r[s++]=+!!l,!l)continue;r[s++]=i.primitiveType,r[s++]=i.geometryType,r[s++]=i.offsetAttribute??-1;let c=+!!m(i.boundingSphere);r[s++]=c,c&&a.pack(i.boundingSphere,r,s),s+=a.packedLength;let u=+!!m(i.boundingSphereCV);r[s++]=u,u&&a.pack(i.boundingSphereCV,r,s),s+=a.packedLength;let p=i.attributes,f=[];for(let e in p)p.hasOwnProperty(e)&&m(p[e])&&(f.push(e),m(o[e])||(o[e]=n.length,n.push(e)));r[s++]=f.length;for(let e=0;e<f.length;e++){let t=f[e],n=p[t];r[s++]=o[t],r[s++]=n.componentDatatype,r[s++]=n.componentsPerAttribute,r[s++]=+!!n.normalize,r[s++]=n.values.length,r.set(n.values,s),s+=n.values.length}let h=m(i.indices)?i.indices.length:0;r[s++]=h,h>0&&(r.set(i.indices,s),s+=h)}return t.push(r.buffer),{stringTable:n,packedData:r}},y.unpackCreateGeometryResults=function(e){let t=e.stringTable,s=e.packedData,l,u=Array(s[0]),p=0,f=1;for(;f<s.length;){let e,m,h;if(1!==s[f++]){u[p++]=void 0;continue}let d=s[f++],g=s[f++],y=s[f++];-1===y&&(y=void 0),1===s[f++]&&(e=a.unpack(s,f)),f+=a.packedLength,1===s[f++]&&(m=a.unpack(s,f)),f+=a.packedLength;let b,k,x,S=new n,C=s[f++];for(l=0;l<C;l++){let e=t[s[f++]],r=s[f++];x=s[f++];let n=0!==s[f++];b=s[f++],k=c.createTypedArray(r,b);for(let e=0;e<b;e++)k[e]=s[f++];S[e]=new i({componentDatatype:r,componentsPerAttribute:x,normalize:n,values:k})}if((b=s[f++])>0){let e=k.length/x;for(h=r.createTypedArray(e,b),l=0;l<b;l++)h[l]=s[f++]}u[p++]=new o({primitiveType:d,geometryType:g,boundingSphere:e,boundingSphereCV:m,indices:h,attributes:S,offsetAttribute:y})}return u},y.packCombineGeometryParameters=function(e,t){let r=e.createGeometryResults,n=r.length;for(let e=0;e<n;e++)t.push(r[e].packedData.buffer);return{createGeometryResults:e.createGeometryResults,packedInstances:function(e,t){let r=e.length,n=new Float64Array(1+19*r),o=0;n[o++]=r;for(let t=0;t<r;t++){let r=e[t];if(l.pack(r.modelMatrix,n,o),o+=l.packedLength,m(r.attributes)&&m(r.attributes.offset)){let e=r.attributes.offset.value;n[o]=e[0],n[o+1]=e[1],n[o+2]=e[2]}o+=3}return t.push(n.buffer),n}(e.instances,t),ellipsoid:e.ellipsoid,isGeographic:e.projection instanceof s,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e.createPickOffsets}},y.unpackCombineGeometryParameters=function(t){let r=function(e){let t=Array(e[0]),r=0,n=1;for(;n<e.length;){let o=l.unpack(e,n),i;m(e[n+=l.packedLength])&&(i={offset:new h(e[n],e[n+1],e[n+2])}),n+=3,t[r++]={modelMatrix:o,attributes:i}}return t}(t.packedInstances),n=t.createGeometryResults,o=n.length,i=0;for(let e=0;e<o;e++){let t=y.unpackCreateGeometryResults(n[e]),o=t.length;for(let e=0;e<o;e++){let n=t[e];r[i].geometry=n,++i}}let a=u.clone(t.ellipsoid),c=t.isGeographic?new s(a):new e(a);return{instances:r,ellipsoid:a,projection:c,elementIndexUintSupported:t.elementIndexUintSupported,scene3DOnly:t.scene3DOnly,vertexCacheOptimize:t.vertexCacheOptimize,compressVertices:t.compressVertices,modelMatrix:l.clone(t.modelMatrix),createPickOffsets:t.createPickOffsets}},y.packCombineGeometryResults=function(e,t){m(e.geometries)&&function(e,t){let r=e.length;for(let n=0;n<r;++n)!function(e,t){let r=e.attributes;for(let e in r)if(r.hasOwnProperty(e)){let n=r[e];m(n)&&m(n.values)&&t.push(n.values.buffer)}m(e.indices)&&t.push(e.indices.buffer)}(e[n],t)}(e.geometries,t);let r=b(e.boundingSpheres),n=b(e.boundingSpheresCV);return t.push(r.buffer,n.buffer),{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:r,boundingSpheresCV:n}},y.unpackCombineGeometryResults=function(e){return{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:k(e.boundingSpheres),boundingSpheresCV:k(e.boundingSpheresCV)}};var x=y;export{x as a};