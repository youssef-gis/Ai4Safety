import{a as e}from"./chunk-D2NFCOGE.js";import{a as r}from"./chunk-VHZAK4GN.js";import{a as t}from"./chunk-T6Q6HX5J.js";import{d as a,i as n}from"./chunk-UTYWXSQT.js";import"./chunk-RCHWDG3R.js";import"./chunk-4WJUWBRK.js";import"./chunk-5G23AKP3.js";import{a as o,b as s,d as u}from"./chunk-KWAHJ72S.js";import{a as f}from"./chunk-MKDADUG3.js";import"./chunk-NOIUI5SY.js";import"./chunk-XRRBRTKL.js";var i=new s,c=new o,p=function(e,t,a,n,u){let p=e.length/3,l=e.subarray(0,p),d=e.subarray(p,2*p),k=e.subarray(2*p,3*p);r.zigZagDeltaDecode(l,d,k);let h=new Float64Array(e.length);for(let e=0;e<p;++e){let r=l[e],p=d[e],b=k[e],m=f.lerp(t.west,t.east,r/32767),w=f.lerp(t.south,t.north,p/32767),y=f.lerp(a,n,b/32767),A=s.fromRadians(m,w,y,i),U=u.cartographicToCartesian(A,c);o.pack(U,h,3*e)}return h},l=new n,d=new u,k=new o,h={min:void 0,max:void 0},b=new o,m=new o,w=new o,y=new o,A=new o,U=e(function(e,r){var s;let f,i=new Uint16Array(e.positions),c=new Uint16Array(e.widths),U=new Uint32Array(e.counts),j=new Uint16Array(e.batchIds);s=new Float64Array(s=e.packedBuffer),f=0,h.min=s[f++],h.max=s[f++],n.unpack(s,f,l),f+=n.packedLength,u.unpack(s,f,d),f+=u.packedLength,o.unpack(s,f,k);let g=p(i,l,h.min,h.max,d),D=g.length/3,T=4*D-4,N=new Float32Array(3*T),R=new Float32Array(3*T),E=new Float32Array(3*T),I=new Float32Array(2*T),P=new Uint16Array(T),x=0,F=0,G=0,S,K=0,W=U.length;for(S=0;S<W;++S){let e=U[S],r=c[S],t=j[S];for(let a=0;a<e;++a){let n;if(0===a){let e=o.unpack(g,3*K,b),r=o.unpack(g,(K+1)*3,m);n=o.subtract(e,r,w),o.add(e,n,n)}else n=o.unpack(g,(K+a-1)*3,w);let s=o.unpack(g,(K+a)*3,y),u;if(a===e-1){let r=o.unpack(g,(K+e-1)*3,b),t=o.unpack(g,(K+e-2)*3,m);u=o.subtract(r,t,A),o.add(r,u,u)}else u=o.unpack(g,(K+a+1)*3,A);o.subtract(n,k,n),o.subtract(s,k,s),o.subtract(u,k,u);let f=2*(0===a),i=a===e-1?2:4;for(let e=f;e<i;++e){o.pack(s,N,x),o.pack(n,R,x),o.pack(u,E,x),x+=3;let a=e-2<0?-1:1;I[F++]=e%2*2-1,I[F++]=a*r,P[G++]=t}}K+=e}let v=t.createTypedArray(T,6*D-6),H=0,B=0;for(W=D-1,S=0;S<W;++S)v[B++]=H,v[B++]=H+2,v[B++]=H+1,v[B++]=H+1,v[B++]=H+2,v[B++]=H+3,H+=4;r.push(N.buffer,R.buffer,E.buffer),r.push(I.buffer,P.buffer,v.buffer);let L={indexDatatype:2===v.BYTES_PER_ELEMENT?t.UNSIGNED_SHORT:t.UNSIGNED_INT,currentPositions:N.buffer,previousPositions:R.buffer,nextPositions:E.buffer,expandAndWidth:I.buffer,batchIds:P.buffer,indices:v.buffer};if(e.keepDecodedPositions){let e=function(e){let r=e.length,t=new Uint32Array(r+1),a=0;for(let n=0;n<r;++n)t[n]=a,a+=e[n];return t[r]=a,t}(U);r.push(g.buffer,e.buffer),L=a(L,{decodedPositions:g.buffer,decodedPositionOffsets:e.buffer})}return L});export{U as default};